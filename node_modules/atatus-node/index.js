function Atatus(t){this.agent=t}var cachedModules=[];cachedModules[882]={exports:{}},function(t,e){"use strict";t.exports=require("loglevel")}.call(this,cachedModules[882],cachedModules[882].exports),cachedModules[6564]={exports:{}},function(t,e){t.exports={name:"atatus-node",version:"0.1.0",description:"The official Atatus agent for Node.js",author:{name:"Atatus, Inc"},homepage:"https://www.atatus.com",keywords:["atatus","apm","error","errors","exceptions","monitor","monitoring","alerts","performance","ops","devops","metrics","stacktrace"],contributors:[],main:"./index.js",dependencies:{shimmer:"^1.1.0",request:"^2.74.0","stack-trace":"^0.0.9","json-stringify-safe":"^5.0.1",loglevel:"^1.4.1",promise:"^7.1.1",semver:"^5.3.0"},devDependencies:{"jasmine-node":"^1.14.2",istanbul:"^0.2.7"},engines:{node:">=0.6.0"},licenses:[{type:"Atatus"}],maintainers:[{name:"atatus",email:"hello@atatus.com"}]}}.call(this,cachedModules[6564],cachedModules[6564].exports),cachedModules[9793]={exports:{}},function(t,e){"use strict";function r(t){return n.resolve(__dirname,t)}var n=require("path"),o=cachedModules[882].exports,i=cachedModules[6564].exports,s=require("os").hostname(),a={enabled:!0,notifyInterval:60,collectErrors:!0,collectTransactions:!0,ignoreStatusCodes:[404],filters:["password"],projectRoot:void 0===require.main?null:n.dirname(require.main.filename),useSSL:!0,proxy:null,notifyHost:"apm-rx.atatus.com",notifyPath:"/track/apm/",notifyPort:void 0,uniqueHostname:s,hostname:s,apiKey:process.env.ATATUS_API_KEY,releaseStage:process.env.NODE_ENV||"production",appVersion:null,customData:null,tags:null,logLevel:"info",sendCode:!0,agentName:i.name,agentVersion:i.version,beforeErrorSend:null,groupingKey:null,captureParams:!1,ignoredParams:[],apdexT:.1,configure:function(t){return a.apiKey=t.apiKey||a.apiKey,a.appVersion=t.appVersion||a.appVersion,a.releaseStage=t.releaseStage||a.releaseStage,a.useSSL=null!=t.useSSL?t.useSSL:a.useSSL,a.filters=t.filters||a.filters,a.ignoreStatusCodes=t.ignoreStatusCodes||a.ignoreStatusCodes,a.notifyHost=t.notifyHost||a.notifyHost,a.notifyPort=t.notifyPort||a.notifyPort,a.notifyPath=t.notifyPath||a.notifyPath,a.customData=t.customData||a.customData,a.tags=t.tags||a.tags,a.hostname=t.hostname||a.hostname,a.proxy=t.proxy,t.logLevel&&(a.logLevel=t.logLevel||a.logLevel,o.setLevel(a.logLevel)),null!=t.projectRoot&&(a.projectRoot=r(t.projectRoot)),a.sendCode=t.sendCode||a.sendCode,"function"==typeof t.beforeErrorSend&&(a.beforeErrorSend=t.beforeErrorSend),"function"==typeof t.groupingKey&&(a.groupingKey=t.groupingKey),"boolean"==typeof t.enabled&&(a.enabled=t.enabled),a.notifyInterval=t.notifyInterval||a.notifyInterval,a}};t.exports=a}.call(this,cachedModules[9793],cachedModules[9793].exports),cachedModules[3963]={exports:{}},function(t,e){"use strict";var r="Custom",n="CustomTotalTime",o="Custom - ",i=" - ";e.recordCustom=function(t,e){var r=t.getDuration(),n=t.getExclusiveDuration(),i=t.transaction,s=o+o+t.name;e&&i.measure(s,e,r,n),i.measure(s,null,r,n)},e.recordBackground=function(t,e){var o=t.getDuration(),s=t.getExclusiveDuration(),a=t.transaction.trace.getTotalTimeDuration(),c=t.transaction,u=t.partialName,l=u+i+t.name;e&&(c.measure(e,null,o,s),c.measure(n+i+l,null,a,s)),c.measure(r+i+"/all",null,o,s),c.measure(n,null,a,s)}}.call(this,cachedModules[3963],cachedModules[3963].exports),cachedModules[5133]={exports:{}},function(t,e){"use strict";function r(t){this.limit=t||10,this.seen=0,this._data=[]}r.prototype.overflow=function(){var t=this.seen-this.limit;return t>=0?t:0},r.prototype.add=function(t){if(this.seen<this.limit)this._data.push(t);else{var e=Math.floor(Math.random()*(this.seen+2));e<this.limit&&(this._data[e]=t)}this.seen++},r.prototype.toArray=function(){return this._data},r.prototype.merge=function(t){if(t&&t.length&&t!==this._data)for(var e=0;e<t.length;e++)this.add(t[e])},t.exports=r}.call(this,cachedModules[5133],cachedModules[5133].exports),cachedModules[8423]={exports:{}},function(t,e){"use strict";var r=require("request"),n=require("util"),o="Atatus Agent:%s  NodeJS:%s",i=t.exports=function(t,e){this.name=t,this.config=e||{},this.userAgent=n.format(o,e.agentVersion,process.versions.node)};i.prototype.request=function(t,e){var n=this.config;t.apiKey=n.apiKey,t.agent={name:n.agentName,version:n.agentVersion},t.uniqueHostname=n.uniqueHostname,t.hostname=n.hostname,t.version=n.appVersion,t.tags=n.tags,t.releaseStage=n.releaseStage;var o=this,i=(o.config.useSSL?"https":"http")+"://"+o.config.notifyHost;o.config.notifyPort&&(i+=":"+o.config.notifyPort),i+=o.config.notifyPath+o.name;var s={method:"POST",url:i,proxy:o.config.proxy,body:t,json:!0,headers:{"accept-encoding":"gzip,deflate","User-Agent":o.userAgent},gzip:!0};r.post(s,function(t,r,n){return t?e(t):200===r.statusCode?e(null,n):e(new Error(n.error||"Request Failed!"))})}}.call(this,cachedModules[8423],cachedModules[8423].exports),cachedModules[1134]={exports:{}},function(t,e){"use strict";function r(t){this._agent=t,this._methods={hostInfo:new o("hostinfo",t.config),errors:new o("error",t.config),error_metrics:new o("error_metric",t.config),metrics:new o("txn",t.config)}}var n=cachedModules[882].exports,o=cachedModules[8423].exports,i=1e3,s=[{interval:15,warn:!1},{interval:15,warn:!1},{interval:30,warn:!0},{interval:60,warn:!1},{interval:120,warn:!1},{interval:300,warn:!1}];r.prototype.sendHostInfo=function(t){function e(u,l,p){if(u&&c.push(u),!u||o>=a)return t(u,l,p);var h=s[o-1];h.warn&&n.warn("Unable to connect to Atatus server after retries:",o),n.debug("Connecting to Atatus Failed. Retrying in:",h.interval),o++,setTimeout(function(){r._sendHostInfo(e)},h.interval*i)}var r=this,o=1,a=s.length,c=[];this._sendHostInfo(e)},r.prototype._sendHostInfo=function(t){var e=this._agent,r={language:"nodejs",environment:e.environment,timestamp:Date.now()};this._methods.hostInfo.request(r,function(e,r,n){return e?t(e,r,n):void t(null,r,n)})},r.prototype.send=function(t,e,r){this._methods[t].request(e,function(e,o,i){return e?(n.error(e,"Sending metrics to Atatus failed: ",t,e.class),r(e,o,i)):r(e,o,i)})},t.exports=r}.call(this,cachedModules[1134],cachedModules[1134].exports),cachedModules[6016]={exports:{}},function(t,e){"use strict";function r(t,e){e=e||{};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}e.shallow=r}.call(this,cachedModules[6016],cachedModules[6016].exports),cachedModules[7331]={exports:{}},function(t,e){"use strict";function r(t,e){var r=[];return t&&t.ignoreStatusCodes&&(r=t.ignoreStatusCodes),r.indexOf(parseInt(e,10))>=0}var n=require("url");t.exports={isError:function(t,e){return e>=400&&!r(t,e)},isIgnoredError:function(t,e){return e>=400&&r(t,e)},scrub:function(t){"string"==typeof t&&(t=n.parse(t));var e=t.pathname;return e?(e=e.split(";")[0],"/"!==e&&"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1))):e="/",e},getHeadersFromHeaderString:function(t){for(var e={},r="",n="",o=0;o<t.length;++o){var i=t[o];"\r"===i?(r=r.replace(/^\s|\s$/g,""),n=n.replace(/^\s|\s$/g,""),0!==n.length&&0!==r.length&&(e[n]=r),r="",n=""):":"===i?(n=r,r=""):r+=i}return e},parseParameters:function(t){var e=t;"string"==typeof t&&(e=n.parse(t,!0));var r={};if(e.query)for(var o=Object.keys(e.query),i=0,s=o.length;i<s;++i){var a=o[i];""===e.query[a]&&e.path.indexOf(a+"=")===-1?r[a]=!0:r[a]=e.query[a]}return r},copyParameters:function(t,e,r){if(t&&t.captureParams&&e&&r)for(var n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];t.ignoredParams.indexOf(i)!==-1||i in r||(r[i]=e[i])}},overwriteParameters:function(t,e,r){if(t&&e&&r)for(var n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];t.ignoredParams.indexOf(i)===-1&&(r[i]=e[i])}}}}.call(this,cachedModules[7331],cachedModules[7331].exports),cachedModules[2210]={exports:{}},function(t,e){"use strict";function r(t){var e=t.split(" - "),r=e.splice(0,2);return{kind:r[0],type:r[1],name:e.join(" - ")}}t.exports={SEGMENT_DELIMITER:" - ",parseName:r}}.call(this,cachedModules[2210],cachedModules[2210].exports),cachedModules[8109]={exports:{}},function(t,e){"use strict";function r(t,e,r,n,o){var s,l="Web/Uri/*",p="",h="Error";r=r||{},"string"==typeof e?p=e:null!==e&&"object"==typeof e&&e.message?(p=e.message,e.name?h=e.name:e.constructor&&e.constructor.name&&(h=e.constructor.name)):t&&t.statusCode&&c.isError(o,t.statusCode)&&(p="HttpError "+t.statusCode),t&&(l=t.getName()||l,s=t.trace.parameters);var d=null;if(!e)return null;d=a(e,o),o.sendCode&&i(d,function(){});var f=l&&u.parseName(l)||{},g={timestamp:n?n:Date.now(),transaction:f.name,kind:f.kind,type:f.type,customData:r.customData,tags:r.tags,user:{id:r.userId},exceptions:[{message:p,class:h,stacktrace:d}],request:s};return o.groupingKey&&(g.groupingKey=o.groupingKey(g)),o.beforeErrorSend&&!o.beforeErrorSend(g)?null:g}function n(t,e,r){var n=e[2],i=e[3],s=(e[4],o(t,i,n,r)),a=[s];return a}function o(t,e,r,n){var o={type:"TransactionError","error.class":e,"error.message":r,timestamp:n};return t?(o.transactionName=t.name,o.duration=t.timer.getDuration()/1e3):o.transactionName="None",o}function i(t,e){var r=4;h.all(t.map(function(t){if(t.inp)return new h(function(e){p.readFile(t.p,function(n,o){if(!n){var i=o.toString().split("\n");t.code=[];for(var s=t.ln-r;s<t.ln-1+r;s++)"string"==typeof i[s]&&t.code.push([""+(s+1),i[s]])}e()})})})).then(e)}function s(t,e){var r=[];return t.forEach(function(t){var n=t.getFileName();if(n&&n.indexOf("node_modules/atatus-node")===-1&&"<anonymous>"!==n){var o={f:n,p:n,m:t.getMethodName()||t.getFunctionName()||"none",ln:t.getLineNumber(),cn:t.getColumnNumber()};e&&n&&0===n.indexOf(e)&&(o.inp=n.indexOf("node_modules")===-1,o.inp||delete o.inp,o.f=o.f.substr(e.length+1)),r.push(o)}}),r}function a(t,e){var r=l.parse(t);return 0===r.length&&(r=l.get()),s(r,e.projectRoot)}var c=cachedModules[7331].exports,u=cachedModules[2210].exports,l=(require("util"),require("stack-trace")),p=require("fs"),h=require("promise");t.exports.createError=r,t.exports.createEvent=n}.call(this,cachedModules[8109],cachedModules[8109].exports),cachedModules[496]={exports:{}},function(t,e){"use strict";function r(){this.startTime=Date.now(),this.metrics={}}var n=cachedModules[2210].exports;r.prototype.incrementErrorCount=function(t,e,r){r=r||1;var n=this.getPerfStat(t);return n.statusCodes[e]?n.statusCodes[e]+=r:n.statusCodes[e]=r,n},r.prototype.getPerfStat=function(t){if(!t)throw new Error("Stat name is missing!");var e=this._resolve(t);return e||(e={statusCodes:{}},this.metrics[t]=e),e},r.prototype.getMetric=function(t){if(!t)throw new Error("Stat name is missing!");return this._resolve(t)},r.prototype._resolve=function(t){var e=this.metrics[t];return e},r.prototype.merge=function(t){this.startTime=Math.min(this.startTime,t.startTime),Object.keys(t.metrics).forEach(function(e){var r=this._resolve(e);r?Object.keys(t.metrics[e].statusCodes).forEach(function(r){var n=t.metrics[e].statusCodes,o=this.metrics[e].statusCodes;o[r]?o[r]+=n[r]:o[r]=n[r]},this):this.metrics[e]=t.metrics[e]},this)},r.prototype.toJSON=function(){var t=[];return Object.keys(this.metrics).forEach(function(e){var r=n.parseName(e);r.statusCodes=this.metrics[e].statusCodes,t.push(r)},this),t},t.exports=r}.call(this,cachedModules[496],cachedModules[496].exports),cachedModules[8354]={exports:{}},function(t,e){"use strict";function r(t){this.config=t,this.errorCount=0,this.errors=[],this.seen=[],this.metrics=new i,this.metricCount=0}var n=(cachedModules[6016].exports,cachedModules[7331].exports),o=(cachedModules[882].exports,cachedModules[8109].exports),i=cachedModules[496].exports,s=o.createError;o.createEvent;t.exports=r;var a=20;r.prototype.onTransactionCompleted=function(t,e){if(!t)throw new Error("ET: Missing transaction.");if(!e)throw new Error("ET: Missing perf data.");if(!t.ignore){var r,o,i=0;if(t.userErrors.length>0)for(o=0;o<t.userErrors.length;o++)r=t.userErrors[o],this.aggregate(t,r[0],r[1],r[2])&&i++;var s=t.exceptions.length>0,a=n.isError(this.config,t.statusCode),c=n.isIgnoredError(this.config,t.statusCode);if(s&&!c)for(o=0;o<t.exceptions.length;o++)r=t.exceptions[o],this.aggregate(t,r[0],r[1],r[2])&&i++;else a&&this.aggregate(t)&&i++}},r.prototype.add=function(t,e,r){if(e){var n=Date.now();t?t.addException(e,r,n):this.aggregate(t,e,r,n)}},r.prototype.addUserError=function(t,e,r){if(e){var n=Date.now();t?t.addUserError(e,r,n):this.aggregate(t,e,r,n)}},r.prototype.aggregate=function(t,e,r,n){if(e){if(this.seen.indexOf(e)!==-1)return;"string"==typeof e||e.message||e.stack||(e=null)}if(!e){if(!t)return;if(!t.statusCode)return;if(t.error)return}if(this.config.collectErrors){e&&this.seen.push(e);var o=s(t,e,r,n,this.config);if(t&&t.name&&t.statusCode&&(this.metrics.incrementErrorCount(t.name,t.statusCode,1),this.metricCount++),o)return this.errorCount++,this.errors.length<a&&this.errors.push(o),!0}},r.prototype.getErrors=function(){return this.errors},r.prototype.getMetrics=function(){return this.metrics},r.prototype.getTotalErrorCount=function(){return this.errorCount},r.prototype.getTotalMetricCount=function(){return this.metricCount},r.prototype.merge=function(t){if(t)for(var e=Math.min(t.length,a-this.errors.length),r=0;r<e;r++)this.errors.push(t[r])},r.prototype.mergeMetrics=function(t){this.metrics.merge(t)},r.prototype.clearMetrics=function(){this.metrics=new i,this.metricCount=0},r.prototype.clearErrors=function(){this.errors=[],this.seen=[],this.errorCount=0}}.call(this,cachedModules[8354],cachedModules[8354].exports),cachedModules[4833]={exports:{}},function(t,e){"use strict";function r(){this.total=0,this.min=0,this.max=0,this.callCount=0}function n(t,e){this.storeValue(t,e>=0?e:null)}r.prototype.storeValue=function(t,e){0===t||t||(t=0),0===e||e||(e=t),this.callCount>0?this.min=Math.min(t,this.min):this.min=t,this.max=Math.max(t,this.max),this.callCount+=1,this.total+=t},r.prototype.storeDuration=n,r.prototype.incrementCallCount=function(t){"undefined"==typeof t&&(t=1),this.callCount+=t},r.prototype.merge=function(t){t.callCount>0&&(this.callCount>0?this.min=Math.min(this.min,t.min):this.min=t.min),this.max=Math.max(this.max,t.max),this.total+=t.total,this.callCount+=t.callCount},r.prototype.toJSON=function(){return[this.callCount,this.total,this.min,this.max]},t.exports=r}.call(this,cachedModules[4833],cachedModules[4833].exports),cachedModules[1464]={exports:{}},function(t,e){"use strict";function r(t){if(!t&&0!==t)throw new Error("ApdexT is missing!");this.apdexT=t,this.satisfying=0,this.tolerating=0,this.frustrating=0}r.prototype.storeValue=function(t){t<=this.apdexT?this.satisfying++:t<=4*this.apdexT?this.tolerating++:this.frustrating++},r.prototype.storeDuration=function(t){this.storeValue(t)},r.prototype.incrementFrustrating=function(){this.frustrating++},r.prototype.merge=function(t){this.satisfying+=t.satisfying,this.tolerating+=t.tolerating,this.frustrating+=t.frustrating},r.prototype.toJSON=function(){return[this.satisfying,this.tolerating,this.frustrating,this.apdexT,this.apdexT,0]},t.exports=r}.call(this,cachedModules[1464],cachedModules[1464].exports),cachedModules[2027]={exports:{}},function(t,e){"use strict";function r(t,e,r){if(void 0===t||null===t||""===t)throw new Error("ApdexT is missing");if(!e)throw new Error("Argument is missing!");if(!r)throw new Error("Argument is missing!");this.startTime=Date.now(),this.apdexT=t,this.mapper=e,this.normalizer=r,this.perfMetric={},this.txnMetric={}}function n(t,e,r,n){var o=this.getPerfStat(t,e);return o.storeDuration(r,n),o}function o(t,e,r){if(!t)throw new Error("Stat name is missing");var n=this._resolve(e),o=r>0?r:this.apdexT;return n[t]||(n[t]=new s(o)),n[t]}var i=cachedModules[4833].exports,s=cachedModules[1464].exports,a=cachedModules[2210].exports;r.prototype.measureDuration=n,r.prototype.getPerfStat=function(t,e){if(!t)throw new Error("Stat name is missing");var r=this._resolve(e);return r[t]||(r[t]=new i),r[t]},r.prototype.getApdexStat=o,r.prototype.getMetric=function(t,e){if(!t)throw new Error("Stat name is missing");return this._resolve(e)[t]},r.prototype.toJSON=function(){return this._toTxnMetricData()},r.prototype.merge=function(t){this.startTime=Math.min(this.startTime,t.startTime),Object.keys(t.perfMetric).forEach(function(e){this.perfMetric[e]?this.perfMetric[e].merge(t.perfMetric[e]):this.perfMetric[e]=t.perfMetric[e]},this),Object.keys(t.txnMetric).forEach(function(e){Object.keys(t.txnMetric[e]).forEach(function(r){if(t.txnMetric[e][r]){var n=this._resolve(e);n[r]?n[r].merge(t.txnMetric[e][r]):n[r]=t.txnMetric[e][r]}},this)},this)},r.prototype._resolve=function(t){var e;return t?(this.txnMetric[t]||(this.txnMetric[t]={}),e=this.txnMetric[t]):e=this.perfMetric,e},r.prototype._getPerfMetricData=function(t){if(this.perfMetric[t]){var e=this.normalizer.normalize(t);if(e){var r=a.parseName(e);return r.durations=this.perfMetric[t],r}}},r.prototype._getTxnMetricData=function(t,e){if(this.txnMetric[e][t]){var r=this.normalizer.normalize(t);if(r){var n=a.parseName(r);return n.durations=this.txnMetric[e][t],n}}},r.prototype._toPerfMetricData=function(){var t={};return Object.keys(this.perfMetric).forEach(function(e){var r=this._getPerfMetricData(e);r&&t.push(r)},this),t},r.prototype._toTxnMetricData=function(){var t=[];return Object.keys(this.txnMetric).forEach(function(e){var r=this._getPerfMetricData(e);r.traces=[],t.push(r),Object.keys(this.txnMetric[e]).forEach(function(t){var n=this._getTxnMetricData(t,e);n&&r.traces.push(n)},this)},this),t},t.exports=r}.call(this,cachedModules[2027],cachedModules[2027].exports),cachedModules[9457]={exports:{}},function(t,e){"use strict";function r(t){return"[object Arguments]"===Object.prototype.toString.call(t)}function n(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n[e]=t[e];return n}function o(t,e,i,s){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e)return!1;if(null===t||null===e)return!1;if(Buffer.isBuffer(t)&&Buffer.isBuffer(e)){if(t.length!==e.length)return!1;for(var a=0;a<t.length;a++)if(t[a]!==e[a])return!1;return!0}if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof RegExp&&e instanceof RegExp)return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(r(t)||r(e))return!(!r(t)||!r(e))&&o(n(t),n(e),i,s);if(t.constructor!==e.constructor)return!1;var c=Object.keys(t),u=Object.keys(e);if(c.length!==u.length)return!1;for(var l=i.length;l--;)if(i[l]===t)return s[l]===e;i.push(t),s.push(e),c.sort(),u.sort();for(var p=c.length-1;p>=0;p--)if(c[p]!==u[p])return!1;for(var h,d=c.length-1;d>=0;d--)if(h=c[d],!o(t[h],e[h],i,s))return!1;return i.pop(),s.pop(),!0}t.exports=function(t,e){return o(t,e,[],[])}}.call(this,cachedModules[9457],cachedModules[9457].exports),cachedModules[7662]={exports:{}},function(t,e){"use strict";function r(t){t||(t={}),this.eachSegment=t.each_segment||!1,this.precedence=t.eval_order||0,this.isTerminal=t.terminate_chain||!1,this.replacement=n(t.replacement||"$0"),this.replaceAll=t.replace_all||!1,this.ignore=t.ignore||!1;var e="";if(this.replaceAll&&(e+="g"),t.match_expression instanceof RegExp)this.pattern=t.match_expression;else try{this.pattern=new RegExp(t.match_expression||"^$",e)}catch(t){this.pattern=/^$/}}var n=(cachedModules[882].exports,function(t){return t.replace(/\\/g,"$")});r.prototype.getSegments=function(t){return this.eachSegment?t.split("/"):[t]},r.prototype.matches=function(t){for(var e=this.getSegments(t),r=0;r<e.length;r++)if(e[r].match(this.pattern))return!0;return!1},r.prototype.apply=function(t){return this.getSegments(t).map(function(t){return""===t?t:t.replace(this.pattern,this.replacement)}.bind(this)).join("/")},r.prototype.toJSON=function(){return{eachSegment:this.eachSegment,precedence:this.precedence,isTerminal:this.isTerminal,replacement:this.replacement,replaceAll:this.replaceAll,ignore:this.ignore,pattern:this.pattern.source}},t.exports=r}.call(this,cachedModules[7662],cachedModules[7662].exports),cachedModules[9067]={exports:{}},function(t,e){"use strict";function r(t,e,r){return t?a+t:e}function n(t,e){return t?t:e}function o(t,e){if(!t)throw new Error("normalizer must be created with configuration.");if(!e)throw new Error("normalizer must be created with a type.");this.config=t,this.type=e,"URL"===e?this.formatter=r:this.formatter=n,this.rules=[]}var i=(cachedModules[882].exports,cachedModules[9457].exports),s=cachedModules[7662].exports,a="CanonicaliedURL";o.prototype.load=function(t){t&&(t.forEach(function(t){var e=new s(t),r=this.rules.some(function(t){return i(t,e)});r||this.rules.push(e)},this),this.rules.sort(function(t,e){return t.precedence-e.precedence}))},o.prototype.loadFromConfig=function(){},o.prototype.addSimple=function(t,e){if(t){var r={match_expression:t,terminate_chain:!0};e?r.replacement=e:r.ignore=!0,this.rules.unshift(new s(r))}},o.prototype.isIgnored=function(t){for(var e=this.rules.length,r=0;r<e;r++){var n=this.rules[r];if(n.ignore&&n.matches(t))return!0}return!1},o.prototype.canNormalize=function(t){for(var e=this.rules.length,r=0;r<e;r++){var n=this.rules[r];if(!n.ignore&&n.matches(t))return!0}return!1},o.prototype.normalize=function(t){for(var e,r=t,n=this.rules.length,o=0;o<n;o++){var i=this.rules[o];if(i.matches(r)){if(e=i.apply(r),i.isTerminal)break;r=e}}return this.formatter(e,t,this.config)},t.exports=o}.call(this,cachedModules[9067],cachedModules[9067].exports),cachedModules[8288]={exports:{}},function(t,e){"use strict";function r(){this.terms=[]}function n(t){for(var e={},r=0,n=t.length;r<n;++r){var o=t[r].prefix;if(o&&"string"==typeof o){"/"!==o[o.length-1]&&(o+="/",t[r].prefix=o);var i=o.split("/");3===i.length&&i[0]&&i[1]&&!i[3]&&Array.isArray(t[r].terms)&&(e[o]=t[r])}}var s=Object.keys(e),a=new Array(s.length);for(r=0,n=s.length;r<n;++r)a[r]=e[s[r]];return a}cachedModules[882].exports;t.exports=r,r.prototype.normalize=function(t){for(var e,r,n=0;n<this.terms.length;n++)if(e=this.terms[n],r=e.prefix,t.lastIndexOf(r,0)!==-1){for(var o,i,s=t.slice(r.length),a=s.split("/"),c=[],u=0;u<a.length&&(i=a[u],""!==i||u+1!==a.length);u++)if(e.terms.indexOf(i)===-1){if("*"===o)continue;c.push(o="*")}else c.push(o=i);return r+c.join("/")}return t},r.prototype.load=function(t){Array.isArray(t)&&(this.terms=n(t))}}.call(this,cachedModules[8288],cachedModules[8288].exports),cachedModules[4122]={exports:{}},function(t,e){"use strict";function r(t){this.perfMetric={},this.txnMetric={},this.length=0,this.load(t)}cachedModules[882].exports;r.prototype.load=function(t){if(t&&t.length)for(var e=0;e<t.length;e++){var r,n=t[e][0],o=n.scope,i=n.name,s=t[e][1];o?(this.txnMetric[o]||(this.txnMetric[o]={}),r=this.txnMetric[o]):r=this.perfMetric,r[i]||this.length++,r[i]=s}},r.prototype.map=function(t,e){return e?this.txnMetric[e]&&this.txnMetric[e][t]?this.txnMetric[e][t]:{name:t,scope:e}:this.perfMetric[t]?this.perfMetric[t]:{name:t}},t.exports=r}.call(this,cachedModules[4122],cachedModules[4122].exports),cachedModules[682]={exports:{}},function(t,e){"use strict";function r(t,e,r){"string"==typeof r&&(r=parseInt(r,16));var o=(r<<1|r>>>31)>>>0,i=n(t,e),s=(o^i)>>>0,a=("00000000"+s.toString(16)).substr(-8);return a}function n(t,e){var r=o.createHash("md5");r.update(new Buffer(t+";"+e),"utf8");var n=new Buffer(r.digest("base64"),"base64");return n.slice(n.length-4,n.length).readUInt32BE(0)}var o=require("crypto");e.calculatePathHash=r,e.getHash=n}.call(this,cachedModules[682],cachedModules[682].exports),cachedModules[7996]={exports:{}},function(t,e){"use strict";function r(){if(u.length>0){var t="Atatus should be the first module before:";u.forEach(function(e){t+="\n\t"+e}),a.warn(t)}}function n(t){}function o(t){var e=s.basename(t,".js");if("index"!==e)return e;for(var r=t.split(s.sep).slice(0,-1),n=r.length-1;n>=0;n--)if("lib"!==r[n])return r[n]}function i(){for(var t in require.cache){if(require.hasOwnProperty(t))return;var e=o(t);c.indexOf(e)!==-1&&u.push(e)}r(u)}var s=require("path"),a=cachedModules[882].exports;t.exports={check:i,createMetrics:n};var c=["connect","express","hapi","memcached","mongodb","mysql","pg","redis","ioredis","restify"],u=[]}.call(this,cachedModules[7996],cachedModules[7996].exports),cachedModules[9294]={exports:{}},function(t,e){"use strict";var r=require("os"),n={OS:r.type(),"OS version":r.release(),"Node.js version":process.version,Architecture:process.arch,"NODE ENV":process.env.NODE_ENV,Processors:r.cpus().length};e.toJSON=function(){return n},e.setFramework=function(t){n.Framework=t}}.call(this,cachedModules[9294],cachedModules[9294].exports),cachedModules[171]={exports:{}},function(t,e){"use strict";function r(t){return 1e3*t[0]+t[1]/1e6}function n(){this.state=i,this.touched=!1,this.duration=null,this.hrDuration=null,this.hrstart=null,this.durationInMillis=null}function o(t){this.touched=!0,this.durationInMillis=t,this.state=a}var i=1,s=2,a=3;n.prototype.begin=function(){this.state>i||(this.start=Date.now(),process.hrtime&&(this.hrstart=process.hrtime()),this.state=s)},n.prototype.end=function(){this.state>s||(this.state===i&&this.begin(),process.hrtime&&(this.hrDuration=process.hrtime(this.hrstart)),this.touched=!0,this.duration=Date.now()-this.start,this.state=a)},n.prototype.touch=function(){this.touched=!0,this.state>s||(this.state===i&&this.begin(),process.hrtime&&(this.hrDuration=process.hrtime(this.hrstart)),this.duration=Date.now()-this.start)},n.prototype.softEnd=function(){return!(this.state>s)&&(this.state===i&&this.begin(),this.state=a,!this.touched&&(process.hrtime&&(this.hrDuration=process.hrtime(this.hrstart)),this.touched=!0,this.duration=Date.now()-this.start,!0))},n.prototype.isRunning=function(){return this.state===s},n.prototype.isActive=function(){return this.state<a},n.prototype.hasEnd=function(){return!!this.hrDuration},n.prototype.overwriteDurationInMillis=o,n.prototype.setDurationInMillis=function(t,e){this.state>s||(this.state===i&&(e||0===e||this.begin()),this.state=a,this.durationInMillis=t,this.hrstart=[Math.floor(e/1e3),e%1e3*1e6],this.start=e)},n.prototype.getDuration=function(){return this.state===i?0:null!==this.durationInMillis&&this.durationInMillis>=0?this.durationInMillis:this.hrDuration?r(this.hrDuration):this.duration?this.duration:process.hrtime?r(process.hrtime(this.hrstart)):Date.now()-this.start},n.prototype.toRange=function(){return[this.start,this.start+this.getDuration()]},n.prototype.startedRelativeTo=function(t){if(this.hrstart&&t.hrstart&&process.hrtime){var e=this.hrstart[0]-t.hrstart[0],n=this.hrstart[1]-t.hrstart[1];return r([e,n])}return this.start-t.start},n.prototype.endsAfter=function(t){return this.getDuration()+this.start>t.getDuration()+t.start},t.exports=n}.call(this,cachedModules[171],cachedModules[171].exports),cachedModules[6840]={exports:{}},function(t,e){"use strict";var r=require("zlib");t.exports={encode:function(t,e){try{r.deflate(JSON.stringify(t),function(t,r){return t?e(t):e(null,r.toString("base64"))})}catch(t){return e(t)}},decode:function(t,e){r.inflate(new Buffer(t,"base64"),function(t,r){if(t)return e(t);try{return e(null,JSON.parse(r))}catch(t){return e(t)}})}}}.call(this,cachedModules[6840],cachedModules[6840].exports),cachedModules[6544]={exports:{}},function(t,e){"use strict";function r(t,e){if(!t.length)return 0;t.sort(function(t,e){return t[0]-e[0]});for(var r,n,o=t[0][0],i=o,s=0,a=0,c=t.length;a<c&&(n=t[a],!(n[0]>e));++a)r=n[1]>e?e:n[1],n[0]>i?(s+=n[0]-i,i=r):r>i&&(i=r);return i-o-s}t.exports=r}.call(this,cachedModules[6544],cachedModules[6544].exports),cachedModules[5956]={exports:{}},function(t,e){"use strict";function r(t,e,r){if(!t)throw new Error("All segment must be associated with a transaction.");if(!e)throw new Error("All segment must be named");this.name=e,this.transaction=t,r&&t.addRecorder(r.bind(null,this)),this.parameters={atatus_exclusive_duration_millis:null},this.children=[],this.timer=new l,this.partialName=null,this._exclusiveDuration=null,this._collect=!0,this.host=null,this.port=null,this.state=p.EXTERNAL,this.async=!0,this.ignore=!1}function n(t,e){this.timer.overwriteDurationInMillis(t,e)}function o(t,e){this.timer.setDurationInMillis(t,e)}function i(t){this._exclusiveDuration=t}function s(){if(this._exclusiveDuration)return this._exclusiveDuration;var t=this.getDuration(),e=this.timer.toRange()[1];return this.children.length>0&&(t-=u(this._getChildPairs(e),e)),t}var a=require("util"),c=cachedModules[7331].exports,u=cachedModules[6544].exports,l=cachedModules[171].exports,p={EXTERNAL:"EXTERNAL",CALLBACK:"CALLBACK"},h=900;r.prototype.moveToCallbackState=function(){this.state=p.CALLBACK},r.prototype.isInCallbackState=function(){return this.state===p.CALLBACK},r.prototype.markAsWeb=function(t){var e=this.transaction;this.name=e.name,this.partialName=e.partialName;var r=e.agent.config,n=a._extend({},this.parameters);delete n.atatus_exclusive_duration_millis,c.copyParameters(r,c.parseParameters(t),n),c.copyParameters(r,n,this.parameters),c.copyParameters(r,n,this.transaction.trace.parameters)},r.prototype.touch=function(){this.timer.touch(),this._updateRootTimer()},r.prototype.overwriteDurationInMillis=n,r.prototype.start=function(){this.timer.begin()},r.prototype.end=function(){this.timer.isActive()&&(this.timer.end(),this._updateRootTimer())},r.prototype._updateRootTimer=function(){var t=this.transaction.trace.root;if(this.timer.endsAfter(t.timer)){var e=this.timer.start+this.getDuration()-t.timer.start;t.overwriteDurationInMillis(e)}},r.prototype._isEnded=function(){return!this.timer.isActive()||this.timer.touched},r.prototype.add=function(t,e){var n=new r(this.transaction,t,e);this.transaction.agent.config;return this.transaction.trace.segmentsSeen++>=h&&(n._collect=!1),this.children.push(n),n},r.prototype.setDurationInMillis=o,r.prototype.getDuration=function(){return this.timer.getDuration()},r.prototype._setExclusiveDurationInMillis=i,r.prototype.getExclusiveDuration=s,r.prototype.getChildren=function(){for(var t=[],e=0,r=this.children.length;e<r;++e)this.children[e].ignore||t.push(this.children[e]);return t},r.prototype._getChildPairs=function(t){if(this.children.length<1)return[];t||(t=1/0);for(var e=this.getChildren(),r=[];e.length;){var n=e.pop(),o=n.timer.toRange();o[0]>=t||(e=e.concat(n.getChildren()),o[1]=Math.min(o[1],t),r.push(o))}return r},r.prototype.toJSON=function(){var t=this.timer.startedRelativeTo(this.transaction.trace.root.timer),e=this.getDuration();this.parameters.atatus_exclusive_duration_millis||(this.parameters.atatus_exclusive_duration_millis=this.getExclusiveDuration());for(var r=this.getChildren(),n=[],o=0,i=r.length;o<i;o++){var s=r[o];s._collect&&n.push(s.toJSON())}return[t,t+e,this.name,this.parameters,n]},t.exports=r}.call(this,cachedModules[5956],cachedModules[5956].exports),cachedModules[9560]={exports:{}},function(t,e){"use strict";function r(t){if(!t)throw new Error("All traces must be associated with a transaction.");this.transaction=t,this.root=new s(t,"ROOT"),this.root.start(),this.custom={},this.intrinsics={},this.segmentsSeen=0,this.totalTimeCache=null,this.parameters={},this.domain=null}function n(t,e){this.root.setDurationInMillis(t,e)}var o=cachedModules[6840].exports,i=cachedModules[6016].exports,s=cachedModules[5956].exports;r.prototype.end=function(){for(var t=[this.root];t.length;){var e=t.pop();e.timer.softEnd()&&e._updateRootTimer(),t=t.concat(e.getChildren())}},r.prototype.add=function(t,e){return this.root.add(t,e)},r.prototype.setDurationInMillis=n,r.prototype.getDuration=function(){return this.root.getDuration()},r.prototype.addParameter=function(t,e){this.parameters[t]=e},r.prototype.getExclusiveDuration=function(){return this.root.getExclusiveDuration()},r.prototype.getTotalTimeDuration=function(){if(null!==this.totalTimeCache)return this.totalTimeCache;if(0===this.root.children.length)return 0;for(var t=this.root.getChildren(),e=0;0!==t.length;){var r=t.pop();e+=r.getExclusiveDuration(),t=t.concat(r.getChildren())}return this.transaction.isActive()||(this.totalTimeCache=e),e},r.prototype.generateJSON=function(t){function e(e,r){if(e)return t(e,null,null);
var n=null;s.transaction.syntheticsData&&(n=s.transaction.syntheticsData.resourceId);var o=[s.root.timer.start,s.transaction.getResponseTime(),s.transaction.name,s.transaction.url,r,"",null,!1,null,n];return t(null,o,s)}var r={agentAttributes:i.shallow(this.parameters),userAttributes:this.custom,intrinsics:this.intrinsics};delete r.agentAttributes.path;var n=[this.root.timer.start,{},{atatus_flatten_leading:!1},this.root.toJSON(),r,[]],s=this;this.transaction.agent.config.simpleCompression?process.nextTick(e.bind(null,null,n)):o.encode(n,e)},t.exports=r}.call(this,cachedModules[9560],cachedModules[9560].exports),cachedModules[1122]={exports:{}},function(t,e){"use strict";function r(t){if(!t)throw new Error("every transaction must be bound to the agent");this.agent=t,this.metrics=new s(t.config.apdexT,t.mapper,t.metricNameRuler),this.id=Math.floor(1e17*Math.random()).toString(16),this.trace=new c(this),this.exceptions=[],this.userErrors=[],this.timer=new a,this.timer.begin(),this._recorders=[],this._intrinsicAttributes={},this.bgSegment=null,this.catResponseTime=0,this.error=null,this.forceIgnore=null,this.forceName=null,this.ignore=!1,this.incomingCatId=null,this.name=null,this.partialName=null,this.pathHashes=[],this.queueTime=0,this.referringPathHash=null,this.referringTransactionGuid=null,this.invalidIncomingExternalTransaction=!1,this.statusCode=null,this.syntheticsHeader=null,this.syntheticsData=null,this.url=null,this.parsedUrl=null,this.verb=null,this.webSegment=null}function n(t,e,r){this.exceptions.push([t,e,r])}function o(t,e,r){this.userErrors.push([t,e,r])}var i=cachedModules[7331].exports,s=cachedModules[2027].exports,a=cachedModules[171].exports,c=cachedModules[9560].exports,u=(cachedModules[682].exports,require("util")),l=require("url"),p="Web",h="Custom",d="CanonicaliedURL",f=" - ";r.prototype.isWeb=function(){return!!this.url},r.prototype.isActive=function(){return this.timer.isActive()},r.prototype.end=function(t){if(this.timer.isActive()){var e=this;e.trace.end(),process.nextTick(function(){e.ignore||e.record(),e.agent.emit("transactionFinished",e),"function"==typeof t&&t(e)}),e.timer.end()}},r.prototype.getResponseTime=function(){return this.isWeb()?this.timer.getDuration():this.trace.getDuration()},r.prototype.applyUserNamingRules=function(t){var e=this.agent.customRuler;e.isIgnored(t)&&(this.ignore=!0),e.canNormalize(t)&&(this.partialName=d+e.normalize(t))},r.prototype.setPartialName=function(t){this.partialName=t},r.prototype.setName=function(t,e){var r;this.url=i.scrub(t),this.statusCode=e,null!==this.forceName&&(this.partialName=this.forceName),this.applyUserNamingRules(this.url),r=this.agent.urlRuler,r.isIgnored(this.url)&&(this.ignore=!0),this.partialName||(this.partialName=r.normalize(this.url)),r=this.agent.txnNameRuler;var n=p+f+this.partialName;r.isIgnored(n)&&(this.ignore=!0),this.name=r.normalize(n),this.name=this.agent.layerNameRuler.normalize(this.name),null!==this.forceIgnore&&(this.ignore=this.forceIgnore)},r.prototype.setBackgroundName=function(t,e){this.partialName=e+f+t;var r=h+f+this.partialName,n=this.agent.txnNameRuler;n.isIgnored(r)&&(this.ignore=!0),this.name=n.normalize(r),null!==this.forceIgnore&&(this.ignore=this.forceIgnore)},r.prototype.getName=function(){if(this.isWeb()&&!this.name){var t=this.partialName;this.setName(this.url,this.statusCode),this.partialName=t}return this.name},r.prototype.getScrubbedUrl=function(){if(this.isWeb()){if(this._scrubbedUrl)return this._scrubbedUrl;if(!this.parsedUrl){if(!this.url)return;this.parsedUrl=l.parse(this.url)}var t=u._extend({},this.parsedUrl);return t.search=null,t.query=null,t.href=null,t.path=null,t.hash=null,this._scrubbedUrl=l.format(t),this._scrubbedUrl}},r.prototype.addRecorder=function(t){this._recorders.push(t)},r.prototype.record=function(){for(var t=this.name,e=0,r=this._recorders.length;e<r;++e)this._recorders[e](t)},r.prototype.measure=function(t,e,r,n){this.metrics.measureDuration(t,e,r,n)},r.prototype._setApdex=function(t,e,r){var n=this.metrics.getApdexStat(t,null,r);i.isError(this.agent.config,this.statusCode)?n.incrementFrustrating():n.storeDuration(e)},r.prototype.pushPathHash=function(t){this.pathHashes.length>=10||this.pathHashes.indexOf(t)!==-1||this.pathHashes.unshift(t)},r.prototype.includesOutboundRequests=function(){return this.pathHashes.length>0},r.prototype.cleanup=function(){this.trace&&this.trace.cleanup()},r.prototype.addException=n,r.prototype.addUserError=o,r.prototype.hasErrors=function(){var t=i.isError(this.agent.config,this.statusCode),e=this.exceptions.length>0,r=this.userErrors.length>0;return e||r||t},r.prototype.addAgentAttribute=function(t,e){this.agent.config.ignoredParams.indexOf(t)===-1&&this.trace.addParameter(t,e)},r.prototype.getIntrinsicAttributes=function(){if(!this._intrinsicAttributes.totalTime){this.agent.config;this._intrinsicAttributes.totalTime=this.trace.getTotalTimeDuration()}return u._extend({},this._intrinsicAttributes)},t.exports=r}.call(this,cachedModules[1122],cachedModules[1122].exports),cachedModules[2370]={exports:{}},function(t,e){"use strict";function r(t){if(!t)throw new Error("Must be initialized with an agent.");this.agent=t,this.segment=null}function n(){return this.segment&&this.segment.transaction&&this.segment.transaction.isActive()?this.segment.transaction:null}function o(){return this.segment}function i(t,e,r){var n=r||this.segment;return n&&n.transaction.isActive()?n.add(t,e):null}function s(t,e,r,n,o){if("function"!=typeof o)throw new Error("task must be a function");var i=this.createSegment(t,e,r);return this.bindFunction(o,i,n)(i)}function a(t){if("function"!=typeof t)return t;var e=this,r=function(){if(e.getTransaction())return t.apply(this,arguments);var r=new _(e.agent);return e.bindFunction(t,r.trace.root).apply(this,arguments)};return r[w]=t,r}function c(t,e){if(void 0===e&&"function"==typeof t&&(e=t,t=void 0),"function"!=typeof e)return e;var r=this,n=function(){var n=r.getTransaction(),o=r.segment,i=!1;return n?"web"===t&&n.bgSegment?i=!0:"custom"===t&&n.webSegment&&(i=!0):i=!0,i&&(n=new _(r.agent),o=n.trace.root),r.bindFunction(e,o).apply(this,arguments)};return n[w]=e,n}function u(t,e,r){function n(){var n=o.segment;o.segment=i,i&&r&&e.start();try{var s=t.apply(this,arguments)}catch(t){throw t}finally{i&&r&&e.touch(),o.segment=n}return s}if("function"!=typeof t)return t;var o=this,i="undefined"==typeof e?o.segment:e;return n[w]=t[w]||t,n[b]=i,n}function l(t){return t&&t[w]?t[w]:t}function p(t){return t&&t[b]?t[b]:null}function h(t,e){function r(){return n.bindFunction(i,o).apply(this,arguments)}if(!t||!t.emit)return t;var n=this,o=e||this.segment,i=t.emit[w]||t.emit;return t.emit=r,t.emit[w]=i,t}function d(t){for(var e=t.length,r=new Array(e),n=0;n<e;n++)r[n]=t[n];return r}function f(t,e,r){function n(){if(!o.getTransaction())return t.apply(this,arguments);var e=o.slice(arguments);if(void 0===r){var n=e.length-1,i=e[n];"function"==typeof i&&(e[n]=o.bindFunction(i))}else e=r(e);return t.apply(this,e)}if("function"!=typeof t)return t;var o=this;return n}function g(t,e){function r(){if(!n.getTransaction())return t.apply(this,arguments);var e=n.slice(arguments),r=e[0];return"function"==typeof r&&(e[0]=n.bindFunction(r)),t.apply(this,e)}if("function"!=typeof t)return t;var n=this;return r}function m(t,e,r){function n(){function n(){return u.touch(),c.apply(this,arguments)}var i=o.getTransaction();if(!i)return r.apply(this,arguments);var s=o.slice(arguments),a=s.length-1,c=s[a];if("function"!=typeof c)return r.apply(this,arguments);var u=o.createSegment(t,e);return s[a]=o.wrapCallback(c,u,n),u.start(),o.bindFunction(r,u).apply(this,s)}if("function"!=typeof r)return r;var o=this;return n}function y(t,e,r){function n(){function n(){c.touch();var t=a.apply(this,arguments);return t}var i=o.getTransaction();if(!i)return r.apply(this,arguments);var s=o.slice(arguments),a=s[0];if("function"!=typeof a)return r.apply(this,arguments);var c=o.createSegment(t,e);return s[0]=o.wrapCallback(a,c,n),c.start(),o.bindFunction(r,c).apply(this,s)}if("function"!=typeof r)return r;var o=this;return n}function v(t,e,r,n,o){function i(){function i(t){return t?s.wrapCallback(t,c,function(){return c.touch(),t.apply(this,arguments)}):t}var a=s.getTransaction();if(!a)return r.apply(this,arguments);var c=s.createSegment(t,e),u=n.call(this,c,s.slice(arguments),i);c.start();var l=s.bindFunction(r,c).apply(this,u);return o&&(l=o.call(this,c,l,i)),l}if("function"!=typeof r||!n)return r;var s=this;return i}function x(t,e,r){function n(){var n=o.getTransaction();if(!n)return r.apply(this,arguments);var i=o.createSegment(t,e);return i&&(i.async=!1),o.bindFunction(r,i,!0).apply(this,arguments)}if("function"!=typeof r)return r;var o=this;return n}function M(t,e,r){var n=this;return"function"!=typeof t?t:n.bindFunction(function(){r&&(r[w]=t);var o=n.createSegment("Callback: "+(t.name||"anonymous"),null,e);return o&&(o.async=!1),n.bindFunction(r||t,o,!0).apply(this,arguments)},e,!1)}var _=cachedModules[1122].exports,w=(cachedModules[882].exports,"__atatusOriginal__"),b="__atatusSegment__";t.exports=r,r.prototype.getTransaction=n,r.prototype.getSegment=o,r.prototype.createSegment=i,r.prototype.addSegment=s,r.prototype.transactionProxy=a,r.prototype.transactionNestProxy=c,r.prototype.bindFunction=u,r.prototype.bindEmitter=h,r.prototype.getOriginal=l,r.prototype.getSegmentFromWrapped=p,r.prototype.slice=d,r.prototype.wrapFunctionNoSegment=f,r.prototype.wrapFunctionFirstNoSegment=g,r.prototype.wrapFunction=v,r.prototype.wrapFunctionLast=m,r.prototype.wrapFunctionFirst=y,r.prototype.wrapSyncFunction=x,r.prototype.wrapCallback=M}.call(this,cachedModules[2370],cachedModules[2370].exports),cachedModules[7690]={exports:{}},function(t,e){"use strict";function r(t){o.call(this),this.config=t,this.events=new i(1e4),this.environment=cachedModules[9294].exports,this.version=this.config.agentVersion,this.transporter=new a(this),this.errors=new c(this.config),this.mapper=new h,this.metricNameRuler=new l(this.config,"metric name"),this.metrics=new u(this.config.apdexT,this.mapper,this.metricNameRuler),this.txnNameRuler=new l(this.config,"transaction name"),this.urlRuler=new l(this.config,"URL"),this.layerNameRuler=new p,this.customRuler=new l(this.config,"custom"),this.customRuler.loadFromConfig(),this.tracer=this._setupTracer(),this.lifeCycleThread=null,this.on("transactionFinished",this._transactionFinished.bind(this))}var n=require("util"),o=require("events").EventEmitter,i=cachedModules[5133].exports,s=cachedModules[882].exports,a=cachedModules[1134].exports,c=cachedModules[8354].exports,u=cachedModules[2027].exports,l=cachedModules[9067].exports,p=cachedModules[8288].exports,h=cachedModules[4122].exports,d=(cachedModules[682].exports,cachedModules[7996].exports),f=1e3;d.check(),n.inherits(r,o),r.prototype.reconfigure=function(t){if(!t)throw new TypeError("must pass configuration")},r.prototype.start=function(t){if(!t)throw new TypeError("callback required!");var e=this;this.transporter.sendHostInfo(function(r,n){return r?t(r,n):void setTimeout(function(){e.harvest(function(r){e._startHarvester(e.config.notifyInterval),t(r,n)})},2e3)})},r.prototype.stop=function(t){if(!t)throw new TypeError("callback required!");this._stopHarvester(),process.nextTick(t)},r.prototype.harvest=function(t){function e(o){function i(r){return r||o>=n.length?t(r):void e(o)}r[n[o++]](i)}if(!t)throw new TypeError("callback required!");var r=this,n=["_sendMetrics","_sendErrors","_sendErrorMetrics"];e(0)},r.prototype._restartHarvester=function(t){this._stopHarvester(),this._startHarvester(t)},r.prototype._stopHarvester=function(){this.lifeCycleThread&&clearInterval(this.lifeCycleThread),this.lifeCycleThread=void 0},r.prototype._startHarvester=function(t){function e(t){t&&s.info(t,"Unable to send metrics to Atatus server. Metrics are cached and will be send in next cycle:")}function r(){n.harvest(e)}var n=this;this.lifeCycleThread=setInterval(r,t*f),this.lifeCycleThread.unref&&this.lifeCycleThread.unref()},r.prototype._setupTracer=function(){var t=cachedModules[2370].exports;return new t(this)},r.prototype._sendMetrics=function(t){var e=this;if(this.metrics.toJSON().length<1)return process.nextTick(t);var r=this.metrics,n=r.startTime,o=Date.now(),i={startTime:n,endTime:o,transactions:r};this.metrics=new u(this.config.apdexT,this.mapper,this.metricNameRuler),this.transporter.send("metrics",i,function(n,o){n&&e.metrics.merge(r),o&&e.mapper.load(o),t(n)})},r.prototype._sendErrors=function(t){var e=this;if(this._processErrorMetrics(),this.config.collectErrors){if(this.errors.getTotalErrorCount()<1)return process.nextTick(t);var r=this.errors.getErrors(),n={customData:e.config.customData,errors:r};this.errors.clearErrors(),this.transporter.send("errors",n,function(n){n&&e.errors.merge(r),t(n)})}else this.errors.clearErrors(),process.nextTick(t)},r.prototype._processErrorMetrics=function(){var t=this.errors.getMetrics(),e=this.errors.getTotalMetricCount();return 0===e?void(this._lastErrorMetrics=null):void(this.config.collectErrors?(this._lastErrorMetrics=t,this.errors.clearMetrics()):e>0&&(this._lastErrorMetrics=null,this.errors.clearMetrics()))},r.prototype._sendErrorMetrics=function(t){if(this.config.collectErrors&&this._lastErrorMetrics){var e=this,r=this._lastErrorMetrics,n={startTime:r.startTime,endTime:Date.now(),errorMetrics:r};e.transporter.send("error_metrics",n,function(n){n&&413===n.statusCode||n&&e.errors.mergeMetrics(r),t(n)})}else process.nextTick(t)},r.prototype._transactionFinished=function(t){if(t.describer,t.ignore)t.forceIgnore===!0;else{t.forceIgnore===!1,this.metrics.merge(t.metrics),this.errors.onTransactionCompleted(t,this.metrics);var e=t.trace;e.intrinsics=t.getIntrinsicAttributes()}},r.prototype.getTransaction=function(){return this.tracer.getTransaction()},t.exports=r}.call(this,cachedModules[7690],cachedModules[7690].exports),cachedModules[8194]={exports:{}},function(t,e){"use strict";function r(t,e){return n.EventEmitter.listenerCount?n.EventEmitter.listenerCount(t,e):t.listeners(e).length}var n=require("events"),o=require("util");t.exports=function(t,e,n,i){function s(t){function e(r){function n(t,e){function r(e){return s.__atatusWrapper__?t(e):(s.__atatusWrapper__=l.bindFunction(a,c,!0),t(e))}function n(t){return s.__atatusSegment__=c,s.__atatusWrapper__?e(t):(s.__atatusWrapper__=l.bindFunction(a,c,!0),e(t))}var c=l.segment;o=this,i=[r,n]}if(!(this instanceof e))return t(r);if("function"!=typeof r)return new t(r);var o,i,s=new t(n);try{r.apply(o,i)}catch(t){i[1](t)}return s.__proto__=e.prototype,s}u(t.prototype,"Promise.prototype",["then","chain"],c);var r=["accept","all","defer","race","reject","resolve"];return r.forEach(function(r){e[r]=t[r]}),o.inherits(e,t),e}function a(t,e,r,n){try{var o=e.call(t,n)}finally{o instanceof Promise?r.__atatusWrapper__=function(){return(o.__atatusWrapper__||a).apply(this,arguments)}:r.__atatusWrapper__=l.bindFunction(a)}return o}function c(t){return function(){function e(t){return"function"!=typeof t?t:function(e){return r.__atatusWrapper__?r.__atatusWrapper__(this,t,n,e):t.call(this,e)}}var r=this,n=t.apply(this,[].map.call(arguments,e));return n}}var u=i.wrapMethod,l=t.tracer;process._fatalException?u(process,"process","_fatalException",function(e){return function(r){return t.errors.add(null,r),t.tracer.segment=null,e.apply(this,arguments)}}):process.on("uncaughtException",function(e){if(t.errors.add(null,e),t.tracer.segment=null,r(process,"uncaughtException")<2)throw e}),process.on("unhandledRejection",function(e,n){if(r(process,"unhandledRejection")<2){var o=n.__atatusSegment__&&n.__atatusSegment__.transaction;t.errors.add(o,e)}}),u(global,"global","Promise",s)}}.call(this,cachedModules[8194],cachedModules[8194].exports),cachedModules[6424]={exports:{}},function(module,exports){"use strict";function mangle(t){var e=t.split(" ");return t=e[e.length-1],RESERVED.indexOf(t)!==-1?t+"_":t}var logger=cachedModules[882].exports,ORIGINAL="__atatusOriginal__",RESERVED=["class","enum","extends","super","const","export","import","implements","let","private","public","yield","interface","package","protected","static"];module.exports=function attach(agent,connect,moduleName,shimmer){function wrapHandle(__atatusHandler__){var arglist,name="";switch(__atatusHandler__.length){case 2:arglist="(req, res)";break;case 3:arglist="(req, res, next)";break;case 4:arglist="(err, req, res, next)";break;default:arglist="()"}__atatusHandler__.name&&(name=mangle(__atatusHandler__.name));var template=function(){var t=tracer.slice(arguments),e=t.length-1;"function"==typeof t[e]&&(t[e]=tracer.bindFunction(t[e])),__atatusHandler__.apply(this,t)},wrapped=eval("(function(){return function "+name+arglist+template.toString().substring(11)+"}())");return wrapped[ORIGINAL]=__atatusHandler__,wrapped}function wrapUse(t){return function(){if(!this.stack)return t.apply(this,arguments);this.stack=this.stack.filter(function(t){return t!==interceptor});var e=t.apply(this,arguments),r=this.stack.pop();r&&(r.handle&&"function"==typeof r.handle&&!r.handle[ORIGINAL]&&(r.handle=wrapHandle(r.handle)),this.stack.push(r));for(var n=!1,o=0;o<this.stack.length;o++){var i=this.stack[o];if(i&&i.handle&&4===i.handle.length){this.stack.splice(o,0,interceptor),n=!0;break}}return n||this.stack.push(interceptor),e}}var tracer=agent.tracer,interceptor={route:"",handle:function(t,e,r,n){if(t){var o=agent.tracer.getTransaction();agent.errors.add(o,t)}return n(t)}},version=connect&&connect.version&&connect.version[0];switch(version){case"1":shimmer.wrapMethod(connect&&connect.HTTPServer&&connect.HTTPServer.prototype,"connect.HTTPServer.prototype","use",wrapUse);break;case"2":shimmer.wrapMethod(connect&&connect.proto,"connect.proto","use",wrapUse)}}}.call(this,cachedModules[6424],cachedModules[6424].exports),cachedModules[8612]={exports:{}},function(t,e){"use strict";function r(t,e,r){var n=e.getDuration(),o=e.getExclusiveDuration(),i=e.transaction,s=e.name+p+t;r&&i.measure(s,r,n,o),i.measure(s,null,n,o)}function n(t,e){var r=t.getDuration(),n=t.getExclusiveDuration(),o=t.transaction;e&&o.measure(t.name,e,r,n),o.measure(t.name,null,r,n)}function o(t){var e=t.split(" ");return t=e[e.length-1],v.indexOf(t)!==-1?t+"_":t}function i(t){t.partialName&&0===t.partialName.lastIndexOf(h,0)||(t.partialName=h+t.verb+p+"/")}function s(t,e){function r(t){var e=n[n.length-1];"/"!==e&&"/"!==t[0]&&(n+="/"),n+="/"===e&&"/"===t[0]?t.substr(1):t}for(var n="",o=0;o<t.length;++o)r(t[o].path);return e&&e.path&&r(e.path),n||"/"}function a(t,e,r,n){if(!t)return l.error("Express: There is no context to set route name.");if(e){r=e.params;var o=t.transaction,s=e.path||e.regexp;s&&(s instanceof RegExp&&(s=s.source),u.copyParameters(o.agent.config,r,t.parameters),n?(i(o),o.partialName+="/"===s[0]?s.slice(1):s):(o.partialName=h+o.verb+p,o.partialName+="/"===s[0]?s:"/"+s))}}function c(t){delete x[t.id]}var u=cachedModules[7331].exports,l=cachedModules[882].exports,p=" ",h="Expressjs - ",d="Nodejs - Expressjs - Middleware - ",f="Nodejs - Expressjs - Middleware - ",g="View - ",m=" Rendering - ",y="__atatusOriginal__",v=["class","enum","extends","super","const","export","import","implements","let","private","public","yield","interface","package","protected","static"],x={};t.exports=function(t,e,l,p){function v(e){return function(){return t.environment.setFramework("express"),e.apply(this,arguments)}}function M(t,e){return function(t,r,o,i,s){if(!T.getTransaction())return e.apply(this,arguments);var a,c=g+m+t,u=T.createSegment(c,n);return"function"==typeof r&&(o=r,r=null),a=null===o||void 0===o?T.bindFunction(function(t,e){if(t)return u.end(),this.req.next(t);u.end();var r=this.send(e);return r}.bind(this)):T.bindFunction(function(){u.end();var t=o.apply(this,arguments);return t},u),e.call(this,t,r,a,i,s)}}function _(t,e){return function(){if(!T.getTransaction())return e.apply(this,arguments);var t=e.apply(this,arguments);return a(T.getSegment(),t),t}}function w(e,o){return function(e){function c(t){return function(e,r,o,i){function s(t){t&&(u.errorHandled=!0,u.error=t),a.transaction.isActive()&&(T.segment=a),m&&m.transaction.isActive()&&m.end(),l&&l.touch(),i.apply(this,arguments)}var a=T.segment,c=a.transaction;if(!c.isActive())return t.apply(this,arguments);var u=C(c);u.errorHandled=!0;var l,p=u.routerStack;if(p.length>0){for(var h=p[p.length-1];0===--h.length;)h=p.pop();l=h.segment}var d=this.handle.name||"anonymous";if(4===this.handle.length){var g=f,m=T.createSegment(g+d,n,l);m&&m.start()}u.lastMiddlewareSegment=m,i&&(arguments[3]=s),t.apply(this,arguments)}}function l(e){return function(n,o,c){function l(t){if(!S&&!_&&!m.responded&&k.length>0){for(var e=k[k.length-1];0===--e.length;)e=k.pop();x=e.segment}return p&&p.end(),x&&x.touch(),f.transaction.isActive()&&(T.segment=f),t&&"route"!==t?(m.error=t,c.apply(this,arguments)):(!m.responded&&I&&(g.partialName=I),void c.apply(this,arguments))}var p,f=T.getSegment();if(!f)return e.apply(this,arguments);var g=f.transaction,m=C(g);if(!g.isActive())return e.apply(this,arguments);if(!o.end[y]){var v=o.end;o.end=function(){m.lastMiddlewareSegment&&m.lastMiddlewareSegment.end();var e=m.routerStack;if(e.length>0)for(var r=e.length-1;r>=0;r--)e[r].segment&&e[r].segment.end();m.responded=!0;var n=m.error,i=m.errorHandled,s=u.isError(t.config,this.statusCode);return!n||i&&!s||t.errors.add(g,n),v.apply(o,arguments)},o.end[y]=v}var x,M=4===this.handle.length,_="mounted_app"===this.name||this.handle.lazyrouter,w=this.handle[y]&&this.handle[y].stack,b=this.route,E=this.handle[y]&&this.handle[y].stack||this.route&&this.route.stack,S=E,k=m.routerStack;if(k.length>0&&(x=k[k.length-1].segment),!M){var A,D;if(_)A=h+"Mounted App: "+this.handle.__atatusPath__;else if(w)A=h+"Router: "+this.handle.__atatusPath__;else if(b)A=h+"Route Path: "+this.handle.__atatusPath__;else{var N=this.handle.name||"anonymous";A=d+N;var R=s(k,this);D=r.bind(null,R)}p=T.createSegment(A,D,x),T.segment=p,p.start()}S?k.push({length:E.length,path:this.handle.__atatusPath__,segment:p}):_?k.push({length:n.app._router.length,path:this.handle.__atatusPath__,segment:p}):m.lastMiddlewareSegment=p,(b||w)&&n.params&&u.copyParameters(g.agent.config,n.params,f.parameters),c&&(arguments[2]=l);var I;if(this.handle.__atatusPath__||this.route){var q=this.handle.__atatusPath__;I=g.partialName,this.route?a(T.getSegment(),this.route,this.params,!0):(i(g),q&&"/"!==q&&(g.partialName+="/"===q[0]?q.slice(1):q),"/"!==g.partialName[g.partialName.length-1]&&(g.partialName+="/"))}return e.apply(this,arguments)}}var g=T.getTransaction();if(!g)return o.apply(this,arguments);if(e){if(e.constructor){var m=e.constructor.prototype;m.handle_request&&!p.isWrapped(m.handle_request)&&p.wrapMethod(m,"express.Layer","handle_request",l),m.handle_error&&!p.isWrapped(m.handle_error)&&p.wrapMethod(m,"express.Layer","handle_error",c)}e.handle&&!p.isWrapped(e.handle)&&(e.handle=b(e.handle,e.path))}return o.apply(this,arguments)}}function b(t,r){var n,i="";switch(t.length){case 2:n="(req, res)";break;case 3:n="(req, res, next)";break;case 4:n="(err, req, res, next)";break;default:n="()"}t.name&&(i=o(t.name));var s,a=function(){var e=T.slice(arguments),r=e.length-1;"function"==typeof e[r]&&(e[r]=T.bindFunction(e[r])),t.apply(this,e)},c=function(){return S.call(this,r,a,[].slice.call(arguments))};s=Object.getPrototypeOf(t)===e.Router||t instanceof e.Router?c:a;var u=new Function("T","t","S","r","a","return function "+i+n+s.toString().substring(11))(T,t,S,r,a);u[y]=t;for(var l=Object.keys(t),p=0;p<l.length;p++){var h=l[p];u[h]=t[h]}return u.__atatusPath__=r,u}function E(t,e){return function(){var t=e.apply(this,arguments),r="string"==typeof arguments[0]?arguments[0]:"/";arguments[0]instanceof RegExp&&(r=arguments[0].toString());for(var n,o=this.stack.length;(n=this.stack[--o])&&n.handle&&"function"==typeof n.handle&&!n.handle[y];)n.handle=b(n.handle,r);return t}}function S(e,r,n){t.tracer.getTransaction();return r.apply(this,n)}function C(t){return x[t.id]||(x[t.id]={routerStack:[],responded:!1,errors:null,errorHandled:!1,lastMiddlewareSegment:null}),x[t.id]}var T=t.tracer,k=t.listeners("transactionFinished").indexOf(c)!==-1;k||t.on("transactionFinished",c);var A=e&&e.version&&e.version[0];switch(!A&&e&&e.application&&e.application.init&&e.response&&e.response.render&&e.Router&&e.Router.prototype.matchRequest?A="3":!A&&e&&e.application&&e.application.init&&e.response&&e.response.render&&e.Router&&e.Router.process_params&&e.application.del?A="4":!A&&e&&e.application&&!e.application.del&&(A="5"),A){case"2":var D=e.createServer(),N=D.routes.constructor;p.wrapMethod(e,"express","createServer",v);var R=require("http");p.wrapMethod(R.ServerResponse.prototype,"http.ServerResponse.prototype","render",M.bind(null,2)),p.wrapMethod(N.prototype,"Router.prototype","_match",_.bind(null,2));break;case"3":p.wrapMethod(e.application,"express.application","init",v),p.wrapMethod(e.response,"express.response","render",M.bind(null,3)),p.wrapMethod(e.Router.prototype,"express.Router.prototype","matchRequest",_.bind(null,3));break;case"4":p.wrapMethod(e.application,"express.application","init",v),p.wrapMethod(e.response,"express.response","render",M.bind(null,4)),p.wrapMethod(e.Router,"express.Router","process_params",w.bind(null,4)),p.wrapMethod(e.Router,"express.Router","use",E.bind(null,!1)),p.wrapMethod(e.Router,"express.Router","route",E.bind(null,!0));break;case"5":p.wrapMethod(e.application,"express.application","init",v),p.wrapMethod(e.response,"express.response","render",M.bind(null,5)),p.wrapMethod(e.Router.prototype,"express.Router.prototype","process_params",w.bind(null,5)),p.wrapMethod(e.Router.prototype,"express.Router.prototype","use",E.bind(null,!1)),p.wrapMethod(e.Router.prototype,"express.Router.prototype","route",E.bind(null,!0))}}}.call(this,cachedModules[8612],cachedModules[8612].exports),cachedModules[3975]={exports:{}},function(t,e){"use strict";function r(t,e){var r=t.getDuration(),n=t.getExclusiveDuration(),o=t.transaction;e&&o.measure(t.name,e,r,n),o.measure(t.name,null,r,n)}function n(t,e){if(!t)return s.error("Hapi: There is no context to set route name.");if(e){var r=t.transaction,n=e.route&&e.route.path;n&&(i.copyParameters(r.agent.config,e.params,t.parameters),r.partialName=c+r.verb+a+n)}}function o(t){t.environment.setFramework("hapi")}var i=cachedModules[7331].exports,s=cachedModules[882].exports,a=" ",c="Hapi - ",u="View - ",l=" Rendering - ";t.exports=function(t,e,i,a){function c(t){return function(e,r,n,o){var i=o,s=w.getSegment();return s&&o&&(i=w.bindFunction(function(){return s.end(),o.apply(this,arguments)})),t.call(this,e,r,n,i)}}function p(e){return function(){if(o(t),this._views){var r=this._views.constructor.prototype;a.wrapMethod(r,"hapi.Views.prototype","render",c)}return e.apply(this,arguments)}}function h(t){return function(){var e=t.apply(this,arguments);if(this._views){var r=this._views.constructor.prototype;a.wrapMethod(r,"hapi.Views.prototype","render",c)}return e}}function d(t){function e(t,e){return t.name=u+l+e[0],e}t.view=w.wrapFunction(u,r,t.view,e)}function f(t){return function(e,r){return w.getTransaction()?(n(w.getSegment(),e),r&&r.view&&d(r),t.apply(this,arguments)):t.apply(this,arguments)}}function g(t,e,r,n){r||(r="*"),e&&Object.keys(e).forEach(function(o){var i=t&&t[o],a=e[o];a.routes&&(a=a.routes);for(var c=0;c<a.length;c++){var u=a[c];i&&i.indexOf(u)!==-1||(u.route&&(u=u.route),u.settings&&u.settings.handler?u.settings.handler=n(u.settings.handler):s.warn("HAPI: Atatus could not instrument since no handler",r,o,u.path))}})}function m(t){return function(e,r){var n=this,o=n._router;if(!o)return s.warn("HAPI: There is no router");var i=o.vhosts,a={};i&&Object.keys(i).forEach(function(t){a[t]={},Object.keys(i[t]).forEach(function(e){var r=i[t][e];r&&r.routes&&(r=r.routes),a[t][e]=r.slice()})});var c;c="function"==typeof o.table?"routes":"table";var u=o[c],l={};u&&Object.keys(u).forEach(function(t){var e=u[t];e.routes&&(e=e.routes),l[t]=e.slice()});var p=t.call(this,e,r);return i=o.vhosts,i&&Object.keys(i).forEach(function(t){g(a[t],i[t],t,f)}),u=o[c],u&&g(l,u,void 0,f),p}}function y(t){return function(){var r=t.apply(this,arguments);return v(r.constructor.prototype,"hapi.Server.constructor.prototype"),a.unwrapMethod(e,"hapi","createServer"),r}}function v(t,e){a.wrapMethod(t,e,"start",p),a.wrapMethod(t,e,"views",h),a.wrapMethod(t,e,"_route",m)}function x(r){return function(){o(t);var n=r.apply(this,arguments);return n&&n.connections&&n.connections.length>0&&(a.wrapMethod(n.connections[0].constructor.prototype,"hapi.Connection.constructor.prototype","_route",m),a.wrapMethod(n.connections[0].server._replier.constructor.prototype,"hapi.Connection.server._replier.constructor.prototype","interface",M),a.unwrapMethod(e.Server.prototype,"hapi.Server.prototype","connection")),n}}function M(t){return function(){var e=t.apply(this,arguments);return a.wrapMethod(e,"hapi.Reply","response",_),e}}function _(e){return function(){var r=t.tracer.getSegment();return r&&r.touch(),e.apply(this,arguments)}}if(!t)return s.error("Hapi: Instrumentation bootstrapped without agent");if(!e)return s.error("Hapi: Instrumentation applied without module");var w=t.tracer,b=e&&e.Server&&e.Server.prototype;b&&b.start&&b.views&&b._route?v(b,"hapi.Server.prototype"):b&&0===Object.keys(b).length?a.wrapMethod(e,"hapi","createServer",y):b&&b.start&&b.route&&b.connection?a.wrapMethod(b,"hapi.Server.prototype","connection",x):s.warn("HAPI: Atatus could not instrument server")}}.call(this,cachedModules[3975],cachedModules[3975].exports),cachedModules[7591]={exports:{}},function(t,e){"use strict";var r=require("json-stringify-safe");t.exports={parse:function(t,e){try{e(null,JSON.parse(t))}catch(t){e(t,null)}},stringify:function(t,e){try{e(null,r(t))}catch(t){e(t,"[UNPARSABLE OBJECT]")}},stringifySync:function(t,e){try{return r(t)}catch(t){return e||"[UNPARSABLE OBJECT]"}}}}.call(this,cachedModules[7591],cachedModules[7591].exports),cachedModules[953]={exports:{}},function(t,e){"use strict";function r(t,e){var r=t.getDuration(),n=t.getExclusiveDuration(),o=t.transaction,i=o.isWeb()?c:u,p=t.name;e&&o.measure(p,e,r,n),o.measure(p,null,r,n),o.measure(s+i,null,r,n),o.measure(s+l+d+i,null,r,n),o.measure(s+a,null,r,n),o.measure(h,null,r,n)}function n(t){return t.key?[t.key]:t.multi?t.command.split(" ").slice(1):[]}var o=cachedModules[7591].exports.stringifySync,i=cachedModules[7331].exports,s="Database - ",a="all",c="web",u="other",l="Memcache",p="Database - Memcache - ",h="Database - Memcache - all",d=" - ";t.exports=function(t,e,s,a){function c(e,r,s){var c=r[0](),u=n(c);if(e.name=p+(c.type||"Unknown"),this.connections&&1===Object.keys(this.connections).length){var l=Object.keys(this.connections)[0].split(":");e.host=l[0],e.port=l[1]}return i.copyParameters(t.config,{key:o(u[0],"Unknown")},e.parameters),a.wrapMethod(c,"metacall","callback",function(t){return s(t,!0,!0)}),r[0]=function(){return c},r}var u=t.tracer;a.wrapMethod(e&&e.prototype,"memcached.prototype","command",function(t){return u.wrapFunction(p+"Unknown",r,t,c)})}}.call(this,cachedModules[953],cachedModules[953].exports),cachedModules[1383]={exports:{}},function(t,e){"use strict";function r(t,e,r,n){this.type=t,this.operation=e,this.model=r,this.trace=null,this.raw="","string"==typeof n&&(this.trace=new Error,this.raw=n)}var n="Database - ",o="all",i="web",s="other",a="",c="",u=".",l=" - ";r.prototype.recordMetrics=function(t,e){var r=t.getDuration(),p=t.getExclusiveDuration(),h=t.transaction,d=h.isWeb()?i:s,f=n+this.type+l+a+this.operation;if(h.measure(f,null,r,p),h.measure(n+d,null,r,p),h.measure(n+this.type+l+d,null,r,p),h.measure(n+this.type+l+o,null,r,p),h.measure(n+o,null,r,p),this.model){var g=n+this.type+l+c+this.model+u+this.operation;h.measure(g,null,r,p),e&&h.measure(g,e,r,p)}else e&&h.measure(f,e,r,p);t.name=g||f},t.exports=r}.call(this,cachedModules[1383],cachedModules[1383].exports),
cachedModules[2674]={exports:{}},function(t,e){"use strict";function r(t){return f.test(t.getSegment().name)}function n(t,e,r){var n=new o(s,r,e),i=n.recordMetrics.bind(n),c=a+e+u+r,l=t.createSegment(c,i);return l.start(),l}var o=cachedModules[1383].exports,i=cachedModules[882].exports,s="MongoDB",a="Database - MongoDB - ",c="Database - MongoDB - ",u=".",l=["addUser","authenticate","collection","collectionNames","collections","command","createCollection","createIndex","cursorInfo","dereference","dropCollection","dropDatabase","dropIndex","ensureIndex","eval","executeDbAdminCommand","indexInformation","logout","open","reIndex","removeUser","renameCollection","stats","_executeInsertCommand","_executeQueryCommand"],p=["aggregate","bulkWrite","count","createIndex","deleteMany","deleteOne","distinct","drop","dropAllIndexes","dropIndex","ensureIndex","findAndModify","findAndRemove","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","geoHaystackSearch","geoNear","group","indexes","indexExists","indexInformation","insert","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","reIndex","remove","rename","replaceOne","save","stats","update","updateMany","updateOne"],h=["put","get","delete"],d=["nextObject","next","toArray","count","explain"];t.exports=function(t,e,o,s){function a(t,e){return t?void i.debug("MongoDB: Instrumentation failed.",t):void e.forEach(f)}function u(t,e,r){var n=r.methods,o=r.options;if(o.callback)for(var a=0;a<n.length;a++){var c,u=n[a];c="each"===u?y:_[t],c?s.wrapMethod(e.prototype,"mongodb."+t+"."+u,u,c):i.debug("MongoDB: No wrapping for",t,u)}}function f(t){for(var e=t.obj,r=t.instrumentations,n=0;n<r.length;n++)u(t.name,e,r[n])}function g(t,e,n){return function(){var e=M.slice(arguments),o=e.length-1,i="function"==typeof e[o]?e[o]:null,s=M.getTransaction(),a=this.collectionName||"unknown";return this.collection&&this.collection.collectionName?a=this.collection.collectionName:this.s&&this.s.name?a=this.s.name||a:this.ns&&(a=this.ns.split(/\./)[1]||a),i&&s?r(M)?t.apply(this,e):n.call(this,e,o,a):t.apply(this,e)}}function m(t,e){return g(t,e,function(r,o,s){var a=n(M,s,e),c=r[o];return this.db&&this.db.serverConfig?(a.host=this.db.serverConfig.host,a.port=this.db.serverConfig.port):this.s&&this.s.topology&&(a.host=this.s.topology.host,a.port=this.s.topology.port),r[o]=M.wrapCallback(c,a,function(){return a.touch(),i.debug("MongoDB: Ended tracking query",s,e),c.apply(this,arguments)}),M.bindFunction(t,a).apply(this,r)})}function y(t,e){return g(t,e,function(r,o,s){function a(t,r){return c.touch(),(t||null===r)&&i.debug("MongoDB: Ended tracking query",p,e),u||(u=M.wrapCallback(l,c,function(){return p.items&&p.items.length||(u=null),l.apply(this,arguments)})),u.apply(this,arguments)}var c=n(M,s,e),u=null,l=r[o],p=this;return i.debug("MongoDB: Stared tracking query",p,e),this.db&&this.db.serverConfig?(c.host=this.db.serverConfig.host,c.port=this.db.serverConfig.port):this.s&&this.s.topology&&(c.host=this.s.topology.host,c.port=this.s.topology.port),r[r.length-1]=a,M.bindFunction(t,c).apply(this,r)})}function v(t,e){return g(t,e,function(r,n){function o(e){function o(){return e.touch(),s.apply(this,arguments)}return r[n]=M.wrapCallback(s,e,o),t.apply(a,r)}var i=c+"GridFS-"+e,s=r[n],a=this;return M.addSegment(i,null,null,!1,o)})}function x(t,e){return g(t,e,function(r,n){function o(e){function o(){return e.touch(),s.apply(this,arguments)}return r[n]=M.wrapCallback(s,e,o),M.bindFunction(t,e).apply(a,r)}var i=c+e,s=r[n],a=this;return M.addSegment(i,null,null,!1,o)})}if(e){var M=t.tracer,_={GridStore:v,OrderedBulkOperation:m,UnorderedBulkOperation:m,CommandCursor:m,AggregationCursor:m,Cursor:m,Collection:m,Db:x};if(e.instrument)return void e.instrument({},a);if(e.Cursor&&e.Cursor.prototype&&(s.wrapMethod(e.Cursor.prototype,"mongodb.Cursor.prototype",d,m),s.wrapMethod(e.Cursor.prototype,"mongodb.Cursor.prototype","each",y)),e.Collection&&e.Collection.prototype&&s.wrapMethod(e.Collection.prototype,"mongodb.Cursor.prototype",p,m),e.Grid&&e.Grid.prototype&&s.wrapMethod(e.Grid.prototype,"mongodb.Grid.prototype",h,v),e.Db&&e.Db.prototype){for(var w=0,b=l.length;w<b;++w)s.wrapMethod(e.Db.prototype,"mongodb.Db.prototype",l[w],x);s.wrapMethod(e.Db,"mongodb.Db","connect",x)}}};var f=new RegExp("^(?:"+a+")|(?:"+c+")")}.call(this,cachedModules[2674],cachedModules[2674].exports),cachedModules[3343]={exports:{}},function(t,e){"use strict";function r(t,e){this.operation=t,this.operationPattern=e}var n=cachedModules[1383].exports;r.prototype.getParsedStatement=function(t,e){this.operationPattern.lastIndex=0;var r=new RegExp("^\\s*"+this.operation,"ig").test(e);if(r){var o=this.operationPattern.exec(e),i=o?o[1]:"unknown";return new n(t,this.operation,i,e)}},t.exports=r}.call(this,cachedModules[3343],cachedModules[3343].exports),cachedModules[5975]={exports:{}},function(t,e){"use strict";var r=(cachedModules[882].exports,cachedModules[3343].exports),n=cachedModules[1383].exports,o=(cachedModules[7591].exports.stringifySync,[new r("select",/^\s*select.*?\sfrom[\s\[]+([^\]\s,)(;]*).*/gi),new r("update",/^\s*update\s+([^\s,;]*).*/gi),new r("insert",/^\s*insert(?:\s+ignore)?\s+into\s+([^\s(,;]*).*/gi),new r("delete",/^\s*delete\s+from\s+([^\s,(;]*).*/gi)]),i=/\/\\*.*?\\*\//;t.exports=function(t,e){if("object"==typeof e&&void 0!==e.sql&&(e=e.sql),"string"!=typeof e)return new n(t,"other",null,e);e=e.replace(i,"").trim();for(var r,s=0,a=o.length;s<a&&!(r=o[s].getParsedStatement(t,e));s++);return r?r:new n(t,"other",null,e)}}.call(this,cachedModules[5975],cachedModules[5975].exports),cachedModules[5895]={exports:{}},function(t,e){"use strict";var r=(cachedModules[882].exports,cachedModules[5975].exports),n="MySQL",o="Database - MySQL - ",i=" - ";t.exports=function(t,e,s,a){function c(t,e){function s(t,e){return e.emit=h.bindFunction(e.emit,t,!0),e}function c(e,s,a){var c="",u=[];1===s.length&&"object"==typeof s[0]?(s[0]._callback=a(s[0]._callback),c=s[0].sql,u.push(s[0])):1===s.length?"function"!=typeof s[0]?(c=s[0].sql,u.push(s[0])):u.push(a(s[0])):2===s.length?(u.push(c=s[0]),"function"!=typeof s[1]?u.push(s[1]):u.push(a(s[1]))):(u.push(c=s[0]),u.push(s[1]),"function"!=typeof s[2]?(u.push(s[2]),u.push(e.touch.bind(e))):u.push(a(s[2])));var l=r(n,c),p=l.model,d=l.operation,f=o+(p||"unknown")+i+d;return h.getTransaction().addRecorder(l.recordMetrics.bind(l,e)),e.name=f,t.config&&t.config.connectionConfig?(e.port=t.config.connectionConfig.port,e.host=t.config.connectionConfig.host):t.config&&(e.port=t.config.port,e.host=t.config.host),u}t&&a.wrapMethod(t,e,"query",function(t){return h.wrapFunction(o+"Unknown",null,t,c,s)})}function u(t){var e,r=[];switch(t.length){case 1:e=t[0];break;case 2:r.push(t[0]),e=t[1];break;default:r.push(t[0]),r.push(t[1]),e=t[2]}return{vargs:r,callback:e}}function l(t,e){return function(){var r,n=u(arguments),o=n.callback&&"function"==typeof n.callback;if(o&&n.callback.__atatusOriginal___callback)r=n.callback;else{var i=h.bindFunction(n.callback);r=function(t,e){c(e,"connection"),i(t,e)},r.__atatusOriginal___callback=n.callback}return n.vargs.push(r),e.apply(t,n.vargs)}}function p(t,e,s){var a=h.getTransaction(),c=r(n,e[0]);return a.addRecorder(c.recordMetrics.bind(c,t)),t.name=o+(c.model||"unknown")+i+c.operation,t.port=this.port,t.host=this.host,e.length>1&&"function"==typeof e[e.length-1]&&(e[e.length-1]=s(e[e.length-1])),e}var h=t.tracer;e&&e.createConnection?(a.wrapMethod(e,"mysql.prototype","createPoolCluster",function(t){return function(){var r=t.apply(e,arguments);return a.wrapMethod(r,"poolCluster","of",function(t){return function(){var e=t.apply(r,arguments);return a.wrapMethod(e,"poolCluster","getConnection",function(t){return l(e,t)}),e}}),a.wrapMethod(r,"poolCluster","getConnection",function(t){return l(r,t)}),r}}),a.wrapMethod(e,"mysql","createPool",function(t){return function(){var r=t.apply(e,arguments);return a.wrapMethod(r,"pool","getConnection",function(t){return l(r,t)}),c(r,"pool"),r}}),a.wrapMethod(e,"mysql","createConnection",function(t){return function(){var e=t.apply(this,arguments);return c(e,"connection"),e}})):e&&e.Client&&a.wrapMethod(e&&e.Client&&e.Client.prototype,"mysql.Client.prototype","query",function(t){return h.wrapFunction(o+"Unknown",null,t,p)})}}.call(this,cachedModules[5895],cachedModules[5895].exports),cachedModules[8474]={exports:{}},function(t,e){"use strict";function r(t,e,r){var a;a=r&&("string"==typeof r||r instanceof String)?r:r&&r.hasOwnProperty("text")?r.text:"Other";var c=n(o,a),u=c.model,l=c.operation;e.name=i+(u||"other")+s+l,t.getTransaction().addRecorder(c.recordMetrics.bind(c,e))}var n=(cachedModules[882].exports,cachedModules[5975].exports),o="Postgres",i="Database - Postgres - ",s=" - ";t.exports=function(t,e,n,o){function s(t,e){var n=[{english:t,nodule:e},{english:t+".pools",nodule:e.pools}];n.forEach(function(t){o.wrapMethod(t.nodule,t.english,"Client",function(t){function e(){function e(t){return function(e){return"function"==typeof e&&(e=l.bindFunction(e)),t.call(this,e)}}function n(t){return l.wrapFunction(i+"Unknown",null,t,s,a)}function s(t,e,n){r(l,t,e[0]);var o=e.length-1,i=e[o];return t.host=c.host,t.port=c.port,e[o]=n(i),e}function a(t,e,r){function n(){t.touch()}function i(t){return function(){arguments[1]&&(arguments[1]=r(arguments[1])),t.apply(this,arguments)}}return e.on("error",n),e.on("end",n),o.wrapMethod(e,"query.on","on",function(t){return function(){return arguments[1]&&(arguments[1]=r(arguments[1])),t.apply(this,arguments)}}),o.wrapMethod(e,"query.addListener","addListener",i),e}var c=t.apply(this,arguments);return"undefined"==typeof c&&(c=this),o.wrapMethod(c,"Connection","connect",e),o.wrapMethod(c,"Connection","query",n),c}return e.prototype=t.prototype,e})})}function a(t){return l.wrapFunction(i+"Unknown",null,t,c,u)}function c(t,e,n){var o=e.length-1,i=e[o];if(r(l,t,e[0]),"function"==typeof i)e[o]=n(i,!0,!0);else if(Array.isArray(i)&&"function"==typeof i[i.length-1]){var s=i[i.length-1];i[i.length-1]=n(s)}return e}function u(t,e,r){function n(){t.end()}function i(t){return function(){arguments[1]&&(arguments[1]=r(arguments[1],!0,!0)),t.apply(this,arguments)}}return e.on("error",n),e.on("end",n),o.wrapMethod(e,"query.on","on",function(t){return function(){return arguments[1]&&(arguments[1]=r(arguments[1],!0,!0)),t.apply(this,arguments)}}),o.wrapMethod(e,"query.addListener","addListener",i),e}if(e){var l=t.tracer;if(process.env.NODE_PG_FORCE_NATIVE)return s("pg",e);var p=e.__lookupGetter__("native");p&&(delete e.native,e.__defineGetter__("native",function(){var t=p();return s("pg.native",t),t})),o.wrapMethod(e&&e.Client&&e.Client.prototype,"pg.Client.prototype","query",a)}}}.call(this,cachedModules[8474],cachedModules[8474].exports),cachedModules[3104]={exports:{}},function(t,e){"use strict";function r(t,e){var r=t.getDuration(),l=t.getExclusiveDuration(),p=t.transaction,h=p.isWeb()?i:s,d=t.name;e&&p.measure(d,e,r,l),p.measure(d,null,r,l),p.measure(n+h,null,r,l),p.measure(n+a+u+h,null,r,l),p.measure(n+o,null,r,l),p.measure(c,null,r,l)}var n="Database - ",o="all",i="web",s="other",a="Redis",c="Database - Redis - all",u=" - ";t.exports=r}.call(this,cachedModules[3104],cachedModules[3104].exports),cachedModules[6707]={exports:{}},function(t,e){"use strict";var r=cachedModules[7591].exports.stringifySync,n=cachedModules[7331].exports,o=cachedModules[3104].exports,i="Database - Redis - ";t.exports=function(t,e,s,a){function c(e,o,s){var a=o.length-1,c=o[1],u=o[a];return e.name=i+(o[0]||"unknown"),c&&"function"!=typeof c&&n.copyParameters(t.config,{key:r(c[0],"Unknown")},e.parameters),e.port=this.port,e.host=this.host,"function"==typeof u?o[a]=s(u,!0,!0):Array.isArray(u)&&"function"==typeof u[u.length-1]?u[u.length-1]=s(u[u.length-1],!0,!0):o.push(s(null,!0,!0)),o}var u=t.tracer;a.wrapMethod(e&&e.RedisClient&&e.RedisClient.prototype,"redis.RedisClient.prototype","send_command",function(t){return u.wrapFunction(i+"Unknown",o,t,c)})}}.call(this,cachedModules[6707],cachedModules[6707].exports),cachedModules[9302]={exports:{}},function(t,e){"use strict";var r=cachedModules[7591].exports.stringifySync,n=cachedModules[7331].exports,o=cachedModules[3104].exports,i="Database - Redis - ";t.exports=function(t,e,s,a){function c(e,o){var s=o[0],a=s.args;return e.name=i+(s.name||"unknown"),a&&"function"!=typeof a&&n.copyParameters(t.config,{key:r(a[0],"Unknown")},e.parameters),e.port=this.connector.options.port,e.host=this.connector.options.host,s.promise.finally(function(){e.touch()}),o}var u=t.tracer;a.wrapMethod(e&&e.prototype,"redis.prototype","sendCommand",function(t){return u.wrapFunction(i+"Unknown",o,t,c)})}}.call(this,cachedModules[9302],cachedModules[9302].exports),cachedModules[2468]={exports:{}},function(t,e){"use strict";function r(t,e,r){if(!t)return n.error("Restify: There is no context to set route name.");if(e){var a=t.transaction,c=e.spec&&(e.spec.path||e.spec.name)||e.name,u=r||e.params;u&&o.copyParameters(a.agent.config,u,t.parameters),c&&(c instanceof RegExp&&(c=c.source),a.partialName=s+a.verb+i+c)}}var n=cachedModules[882].exports,o=cachedModules[7331].exports,i=" ",s="Restify - ";t.exports=function(t,e,n,o){o.wrapMethod(e,"restify","createServer",function(e){return function(){t.environment.setFramework("restify");var n=e.apply(this,arguments),i=n.router.constructor;return o.wrapMethod(i.prototype,"Router.prototype","find",function(e){return function(n,o,i){var s=t.tracer;if(!s.getTransaction())return e.apply(this,arguments);var a=function(t,e,n){return r(s.getSegment(),e,n),i(t,e,n)};return e.call(this,n,o,a)}}),n}})}}.call(this,cachedModules[2468],cachedModules[2468].exports),cachedModules[3806]={exports:{}},function(t,e){"use strict";function r(t,e,o,i){var s=i.wrapMethod;e!==global&&n.satisfies(process.version,">=1.6.3")&&global.setTimeout&&!global.setTimeout.__atatusOriginal__&&r(t,global,o,i);var a=["nextTick","_nextDomainTick","_tickDomainCallback"];s(process,"process",a,function(e,r){return t.tracer.wrapFunctionFirstNoSegment(e,r)});var c=["setTimeout","setInterval"];s(e,"timers",c,function(e,r){return t.tracer.wrapFunctionFirst("timers."+r,null,e)});var u=["setImmediate"];s(e,"timers",u,function(e,r){return t.tracer.wrapFunctionFirstNoSegment(e,r)});var l=["clearTimeout"];s(e,"timers",l,function(e){return function(r){var n;return r&&r._onTimeout&&(n=t.tracer.getSegmentFromWrapped(r._onTimeout),r._onTimeout=t.tracer.getOriginal(r._onTimeout)),r&&r._onImmediate&&(r._onImmediate=t.tracer.getOriginal(r._onImmediate)),n&&(n.ignore=!0),e.apply(this,arguments)}})}var n=require("semver");t.exports=r}.call(this,cachedModules[3806],cachedModules[3806].exports),cachedModules[3039]={exports:{}},function(t,e){"use strict";function r(t,e,r,n){function o(e,r){function n(){return e.apply(this,arguments)}return t.tracer.wrapFunctionLast("crypto."+r,null,n)}var i=n.wrapMethod;i(e,"crypto",["pbkdf2","randomBytes","pseudoRandomBytes"],o)}t.exports=r}.call(this,cachedModules[3039],cachedModules[3039].exports),cachedModules[7218]={exports:{}},function(t,e){"use strict";function r(t,e,r){"string"==typeof t&&(r.incomingCatId=t),o.isArray(e)&&(r.referringTransactionGuid=e[0],"string"==typeof e[2]?r.tripId=e[2]:e[2]&&(r.invalidIncomingExternalTransaction=!0),n(e[3])?r.referringPathHash=e[3]:e[3]&&(r.invalidIncomingExternalTransaction=!0))}function n(t){return"string"==typeof t}var o=require("util");cachedModules[682].exports,cachedModules[882].exports;t.exports.parsedHeadersToTrans=r}.call(this,cachedModules[7218],cachedModules[7218].exports),cachedModules[780]={exports:{}},function(t,e){"use strict";function r(t,e){if(!t)throw new Error("External request metrics need to be associated with a host. Not measuring.");return function(r,n){var o=r.getDuration(),p=r.getExclusiveDuration(),d=r.transaction,f=i+e+h+t,g=d.isWeb()?a:c,m=s+t;r.catId&&r.catTransaction?(d.measure(u+t+h+r.catId+"/all",null,o,p),d.measure(l+r.catId+h+t+h+r.catTransaction,null,o,p),n&&d.measure(l+r.catId+h+t+h+r.catTransaction,n,o,p)):n&&d.measure(f,n,o,p),d.measure(f,null,o,p),d.measure(g,null,o,p),d.measure(m,null,o,p),d.measure(s,null,o,p)}}function n(t,e,n,s){function a(e){var r=s();e.start(),e.name+=o.scrub(r.path);var n=o.parseParameters(r.path);o.copyParameters(t.config,n,e.parameters),r.once("error",function(n){e.end();var o=Array.isArray(r._events.error)&&r._events.error.length||!Array.isArray(r._events.error)&&r._events.error;o||t.errors.add(c,n)});var i=r.listeners("response").slice();r.removeAllListeners("response"),r.on("response",function(r){t.tracer.bindEmitter(r),r.on("end",e.end.bind(e))});for(var a=0;a<i.length;a++)r.on("response",i[a]);return t.tracer.bindEmitter(r),r}if(!e)throw new Error("hostname must be defined!");if(!n||n<1)throw new Error("port must be defined!");n&&n!==d&&(e=e+":"+n);var c=t.tracer.getTransaction(),u=i+p+h+e;return t.tracer.addSegment(u,r(e,p),null,!1,a)}var o=cachedModules[7331].exports,i=(cachedModules[682].exports,cachedModules[882].exports,"Remote - "),s="Remote - all",a="Remote - web",c="Remote - other",u="RemoteApp - ",l="RemoteTransaction - ",p="Remote HTTP calls",h=" - ",d=80;t.exports=n}.call(this,cachedModules[780],cachedModules[780].exports),cachedModules[2279]={exports:{}},function(t,e){"use strict";function r(t,e){if(e){var r=t.transaction;if(!r.webSegment||t===r.webSegment){var n=t.getDuration(),o=r.trace.getTotalTimeDuration(),i=t.getExclusiveDuration(),s=t.partialName;t.transaction.agent.config;r.measure(p,null,n,i),r.measure(h,null,o,i),r.measure(d,null,n,i),r.measure(e,null,n,i),r.measure(h+g+s,null,o,i),r.queueTime>0&&r.measure(f,null,r.queueTime)}}}function n(t,e){if(!e)throw new Error("No request listener defined, so nothing to do.");var n=t.tracer;return n.transactionProxy(function(t,o){function i(){if(s.setName(s.parsedUrl,o.statusCode),o&&void 0!==o.statusCode){var t=o.statusCode,e=parseInt(t,10);e===e&&s.addAgentAttribute("statusCode",e)}d.markAsWeb(s.parsedUrl),d.end(),s.end()}var s=n.getTransaction();if(!s)return e.apply(this,arguments);var a=["accept","accept-encoding","accept-language","contentLength","contentType","referer","host"];if(t){for(var c=0;c<a.length;c++){var l=a[c],p=t.headers[l.toLowerCase()];if(void 0!==p){var h=l;s.addAgentAttribute(h,p)}}void 0!==t.method&&s.addAgentAttribute("method",t.method),void 0!==t.headers["user-agent"]&&s.addAgentAttribute("userAgent",t.headers["user-agent"]),s.addAgentAttribute("ip",t.headers["x-forwarded-for"]||t.connection&&t.connection.remoteAddress||t.ip)}var d=n.createSegment(t.url,r);if(d.start(),s.webSegment=d,n.bindEmitter(t,d),n.bindEmitter(o,d),s.parsedUrl=u.parse(t.url,!0),s.url=s.parsedUrl.pathname,s.verb=t.method,"function"==typeof this.address){var f=this.address();f&&(s.port=f.port)}s.addAgentAttribute("path",t.url),s.addAgentAttribute("port",t.headers["x-forwarded-port"]||t.port||s.port),s.applyUserNamingRules(t.url);var g=t.headers[x]||t.headers[M];if(g){var m=g.split("=");m.length>1&&(g=m[1]);var y=parseFloat(g);isNaN(y)||(y>1e18?y/=1e6:y>1e15?y/=1e3:y<1e12&&(y=1e3*y),s.queueTime=Date.now()-y)}return o.once("finish",i),n.bindFunction(e,d).apply(this,arguments)})}function o(t,e){return function(r){function n(){var t=e.apply(p,l);if(!h)return t;try{for(f=0,g=x.length;f<g;++f)t.setHeader(x[f],s[x[f]])}catch(t){r&&r.headers&&"object"==typeof r.headers}return t}var o=t.tracer,i=o.getTransaction(),s={},l=o.slice(arguments),p=this,h=!1,d=r&&r[m];d&&(r[m]=void 0);var f,g,x=Object.keys(s);if(i&&!d){if(c.isArray(r.headers))for(r=c._extend({},r),r.headers=r.headers.slice(),l[0]=r,f=0,g=x.length;f<g;++f)r.headers.push([x[f],s[x[f]]]);else"object"==typeof r&&r.headers&&r.headers.expect?(r=c._extend({},r),r.headers=c._extend({},r.headers),r.headers=c._extend(r.headers,s),l[0]=r):h=!0;var M=r;"string"==typeof r&&(M=u.parse(r));var _=M.hostname||M.host||y,w=M.port||M.defaultPort||v;return a(t,_,w,n)}return n()}}function i(t,e){return function(r,n,o){var i=e.bind(this,r,n,o);return t.tracer.getTransaction()?a(t,this.host,this.port,i):i()}}function s(t,e){shimmer.wrapMethod(e,"http.Client.prototype","request",i.bind(null,t))}var a=(cachedModules[882].exports,cachedModules[682].exports,cachedModules[7218].exports,cachedModules[780].exports),c=require("util"),u=require("url"),l=(cachedModules[7331].exports,require("semver")),p="Web",h="WebTotalTime",d="HttpDispatcher",f="WebFrontend - QueueTime",g=" - ",m="__atatusConnection__",y="localhost",v=80,x="atatus-request",M="atatus-queue";t.exports=function(t,e,r,i){function a(){c&&(delete e.Client,e.Client=c),u&&(delete e.createClient,e.createClient=u)}i.wrapMethod(e,"http","createServer",function(t){return function(e){return t.apply(this,arguments)}}),i.wrapMethod(e&&e.Server&&e.Server.prototype,"http.Server.prototype",["on","addListener"],function(e){return function(r,o){return"request"===r&&"function"==typeof o?e.call(this,r,n(t,o)):e.apply(this,arguments)}}),e&&e.Agent&&e.Agent.prototype&&e.Agent.prototype.request?i.wrapMethod(e.Agent.prototype,"http.Agent.prototype","request",o.bind(null,t)):("https"!==r||l.satisfies(process.version,"<=0.10.x"))&&i.wrapMethod(e,"http","request",o.bind(null,t));var c,u;c=i.wrapDeprecated(e,"http","Client",{get:function(){var e=new c(80,"localhost");return s(t,e.constructor.prototype),a(),c},set:function(t){c=t}}),u=i.wrapDeprecated(e,"http","createClient",{get:function(){var e=u(80,"localhost");return s(t,e.constructor.prototype),a(),u},set:function(t){u=t}})}}.call(this,cachedModules[2279],cachedModules[2279].exports),cachedModules[9286]={exports:{}},function(t,e){"use strict";function r(t){function e(t){return(t=Number(t))>=0&&t}var r={};"object"==typeof t[0]&&null!==t[0]?r=t[0]:"string"==typeof t[0]&&e(t[0])===!1?r.path=t[0]:(r.port=t[0],"string"==typeof t[1]&&(r.host=t[1]));var n=t[t.length-1];return"function"==typeof n?[r,n]:[r]}t.exports=function(t,e,n,o){function i(e){return function(){function r(e,r){if("connection"!==e||!r||!r._handle)return o.apply(this,arguments);var i=t.tracer.createSegment("net.Server.onconnection",null,n);return r._handle.onread&&(r._handle.onread=t.tracer.bindFunction(r._handle.onread,i)),t.tracer.bindFunction(o,i,!0).apply(this,arguments)}var n=t.tracer.getSegment(),o=this.emit;return n&&o?(this.emit=r,e.apply(this,arguments)):e.apply(this,arguments)}}function s(e){return function(){function n(r){i[1]&&(i[1]=t.tracer.bindFunction(i[1],r));var n=e.apply(o,i);return o._handle&&(o._handle.onread=t.tracer.bindFunction(o._handle.onread,r)),t.tracer.bindEmitter(o,r),n}if(!t.getTransaction())return e.apply(this,arguments);var o=this,i=r(arguments);return t.tracer.addSegment("net.Socket.connect",null,null,!0,n)}}var a=o.wrapMethod;a(e.Server.prototype,"net.Server.prototype","_listen2",i),a(e.Socket.prototype,"net.Socket.prototype","connect",s)}}.call(this,cachedModules[9286],cachedModules[9286].exports),cachedModules[551]={exports:{}},function(t,e){"use strict";function r(t,e,r,n){try{c[e](t,r,n,l)}catch(t){i.debug("Instrumentation is failed for module:",e)}}function n(t,e,n){var i,a=o.basename(n);return"pg.js"===n&&(i="pg"),i="mysql2"===n?"mysql":a,s.indexOf(i)!==-1&&r(t,a,e),e}var o=require("path"),i=(require("fs"),cachedModules[882].exports),s=["connect","express","hapi","memcached","mongodb","mysql","pg","redis","ioredis","restify"],a=["timers","crypto","http","https","net"],c={globals:cachedModules[8194].exports,connect:cachedModules[6424].exports,express:cachedModules[8612].exports,hapi:cachedModules[3975].exports,memcached:cachedModules[953].exports,mongodb:cachedModules[2674].exports,mysql:cachedModules[5895].exports,pg:cachedModules[8474].exports,redis:cachedModules[6707].exports,ioredis:cachedModules[9302].exports,restify:cachedModules[2468].exports,timers:cachedModules[3806].exports,crypto:cachedModules[3039].exports,http:cachedModules[2279].exports,https:cachedModules[2279].exports,net:cachedModules[9286].exports},u=[],l=t.exports={debug:!1,isWrapped:function(t){return!(!t||!t.__atatusOriginal__)},wrapMethod:function(t,e,r,n){return r?(e||(e="[unknown]"),Array.isArray(r)||(r=[r]),void r.forEach(function(e){if(t&&n){var r=t[e];if(r&&!r.__atatusUnwrap__){var o=n(r,e);o.__atatusOriginal__=r,o.__atatusUnwrap__=function(){t[e]=r},t[e]=o,l.debug&&u.push(o)}}})):i.warn(new Error,"Wrap: Method name is missing")},wrapDeprecated:function(t,e,r,n){if(!r)return void i.warn(new Error,"Wrap: Function name is missing");e||(e="[unknown]");if(t){var o=t[r];if(o){delete t[r];var s={configurable:!0,enumerable:!0};return n.get&&(s.get=n.get),n.set&&(s.set=n.set),Object.defineProperty(t,r,s),o}}},unwrapMethod:function(t,e,r){if(e||(e="[unknown]"),r){if(t){var n=t[r],o=u.indexOf(n);o!==-1&&u.splice(o,1),n&&n.__atatusUnwrap__&&n.__atatusUnwrap__()}}},unwrapAll:function(){u.forEach(function(t){t.__atatusUnwrap__()}),u=[]},patchModule:function(t){var e=require("module");l.wrapMethod(e,"Module","_load",function(e){return function(r){return n(t,e.apply(this,arguments),r)}})},unpatchModule:function(){var t=require("module");l.unwrapMethod(t,"Module","_load")},startInstrumentation:function(t){r(t,"globals",global),a.forEach(function(e){var n;try{n=require(e)}catch(t){}r(t,e,n,e)})},reinstrument:function(t,e){return n(t,require(e),e)}}}.call(this,cachedModules[551],cachedModules[551].exports);var util=require("util"),logger=cachedModules[882].exports,config=cachedModules[9793].exports,recorder=cachedModules[3963].exports;Atatus.prototype.notifyError=function(t,e){"string"==typeof t&&(t=new Error(t));var r=this.agent.tracer.getTransaction();this.agent.errors.addUserError(r,t,e)},Atatus.prototype.excludeURL=function(t){return t?void this.agent.customRuler.addSimple(t,null):logger.error("URL pattern is empty!")},Atatus.prototype.createLayer=function(t,e){if(!this.agent||!this.agent.config.enabled)return logger.warn("The Atatus agent is disabled."),e;if(!t||"function"!=typeof e)return logger.warn("Invalid input arguments!"),e;var r=this.agent.tracer,n=r.getTransaction();if(!n)return logger.debug("No transaction to create layer:",t),e;var o=r.createSegment(t,recorder.recordCustom);return o.start(),r.bindFunction(e,o,!0)},Atatus.prototype.startTransaction=function(t,e){if(!this.agent||!this.agent.config.enabled)return logger.warn("The Atatus agent is disabled."),e;if(!t||"function"!=typeof e)return logger.warn("Invalid input arguments!"),e;var r="Background",n=this.agent.tracer;return n.transactionNestProxy("custom",function(){var o=n.getTransaction();return o.setBackgroundName(t,r),o.bgSegment=n.createSegment(t,recorder.recordBackground),o.bgSegment.partialName=r,o.bgSegment.start(),n.bindFunction(e,o.bgSegment).apply(this,arguments)})},Atatus.prototype.endTransaction=function(){if(!this.agent||!this.agent.config.enabled)return void logger.warn("The Atatus agent is disabled.");var t=this.agent.tracer,e=t.getTransaction();e?(e.webSegment?(e.setName(e.url,0),e.webSegment.markAsWeb(e.url),e.webSegment.end()):e.bgSegment&&e.bgSegment.end(),e.end()):logger.debug("No transaction to end.")},Atatus.prototype.stop=function(t,e){var r=e;r||(r="function"==typeof t?t:new Function);var n=this.agent;t&&t.reportBeforeStop?n.harvest(function(t){t&&logger.error(t,"An error occurred in sending metrics."),n.stop(r)}):n.stop(r)},Atatus.prototype.start=function(t){if(this.__atatusInitialized__)return logger.error("Do not call atatus.start() more than once.");this.__atatusInitialized__=!0;try{if(!t)return logger.error("Configuration option is missing for Atatus agent.");if(config.configure(t),!config.enabled)return logger.warn("The Atatus agent is disabled.");if(!config.apiKey)return logger.error("Atatus agent API key is missing.");var e=cachedModules[7690].exports,r=new e(config);this.agent=r,this.excludeURL("^/socket\\.io");var n=cachedModules[551].exports;n.patchModule(r),n.startInstrumentation(r),r.start(function(t){return t?(logger.error("Atatus agent is stopped due to an error"),logger.error(t),void logger.error(t&&t.stack)):logger.debug("Atatus agent is started successfully")})}catch(t){logger.error("Atatus agent is unable to start due to an error"),logger.error(t),logger.error(t&&t.stack)}return this},module.exports=new Atatus;
